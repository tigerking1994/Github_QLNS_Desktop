IF EXISTS (SELECT * FROM [dbo].[BH_DM_MucLucNganSach] where iID = '353debe4-7d38-4d02-9172-307ddbca8beb')
DELETE FROM [dbo].[BH_DM_MucLucNganSach] where iID = '353debe4-7d38-4d02-9172-307ddbca8beb'
BEGIN
INSERT [dbo].[BH_DM_MucLucNganSach] ([iID], [sXauNoiMa], [sLNS], [sL], [sK], [sM], [sTM], [sTTM], [sNG], [sTNG], [sMoTa], [bHangCha], [iTrangThai], [bDuPhong], [bHangChaDuToan], [bHangChaQuyetToan], [bHangMua], [bHangNhap], [bHienVat], [bNgay], [bPhanCap], [bSoNguoi], [bTonKho], [bTuChi], [sChiTietToi], [dNgaySua], [dNgayTao], [iLoai], [iLock], [iID_MaDonVi], [iID_MaBQuanLy], [Log], [iID_MLNS], [iID_MLNS_Cha], [iNamLamViec], [sCPChiTietToi], [sDuToanChiTietToi], [sNguoiSua], [sNguoiTao], [sNhapTheoTruong], [sQuyetToanChiTietToi], [Tag], [sTNG1], [sTNG2], [sTNG3], [iLoaiNganSach], [sMaCB], [sMaPhuCap], [bHangChaDuToanDieuChinh], [sDuToanDieuChinhChiTietToi], [iDonViTinh], [fTyLe_BHTN_NLD], [fTyLe_BHTN_NSD], [fTyLe_BHXH_NLD], [fTyLe_BHXH_NSD], [fTyLe_BHYT_NLD], [fTyLe_BHYT_NSD], [sLuongChinh], [sNS_LuongChinh], [sNS_PCCV], [sNS_PCTN], [sNS_PCTNVK], [sPCCV], [sPCTN], [sPCTNVK], [sNS_HSBL]) VALUES (N'353debe4-7d38-4d02-9172-307ddbca8beb', N'9010001-010-011-0001-0001-0001-02-02', N'9010001', N'010', N'011', N'0001', N'0001', N'0001', N'02', N'02', N'* Từ 14 ngày trở lên/tháng (ngày)', 0, 1, 0, NULL, 0, 0, 0, 0, 0, 0, 0, 0, 0, N'NG', CAST(N'2024-02-05T09:33:14.260' AS DateTime), CAST(N'2023-11-29T08:58:28.103' AS DateTime), N'STNG', 0, NULL, NULL, NULL, N'd0b64142-699e-4f9e-a6f5-824b03051c0e', N'4ecb27b3-f09b-4972-9d22-965886faab0a', 2024, NULL, NULL, N'admin', NULL, NULL, N'TNG', NULL, N'', N'', N'', NULL, NULL, NULL, 0, NULL, 1, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
END 
GO

IF EXISTS (SELECT * FROM [dbo].[BH_DM_MucLucNganSach] where iID = '16104345-1099-43cf-81ee-226b68af03c8')
DELETE FROM [dbo].[BH_DM_MucLucNganSach] where iID = '16104345-1099-43cf-81ee-226b68af03c8'
BEGIN
INSERT [dbo].[BH_DM_MucLucNganSach] ([iID], [sXauNoiMa], [sLNS], [sL], [sK], [sM], [sTM], [sTTM], [sNG], [sTNG], [sMoTa], [bHangCha], [iTrangThai], [bDuPhong], [bHangChaDuToan], [bHangChaQuyetToan], [bHangMua], [bHangNhap], [bHienVat], [bNgay], [bPhanCap], [bSoNguoi], [bTonKho], [bTuChi], [sChiTietToi], [dNgaySua], [dNgayTao], [iLoai], [iLock], [iID_MaDonVi], [iID_MaBQuanLy], [Log], [iID_MLNS], [iID_MLNS_Cha], [iNamLamViec], [sCPChiTietToi], [sDuToanChiTietToi], [sNguoiSua], [sNguoiTao], [sNhapTheoTruong], [sQuyetToanChiTietToi], [Tag], [sTNG1], [sTNG2], [sTNG3], [iLoaiNganSach], [sMaCB], [sMaPhuCap], [bHangChaDuToanDieuChinh], [sDuToanDieuChinhChiTietToi], [iDonViTinh], [fTyLe_BHTN_NLD], [fTyLe_BHTN_NSD], [fTyLe_BHXH_NLD], [fTyLe_BHXH_NSD], [fTyLe_BHYT_NLD], [fTyLe_BHYT_NSD], [sLuongChinh], [sNS_LuongChinh], [sNS_PCCV], [sNS_PCTN], [sNS_PCTNVK], [sPCCV], [sPCTN], [sPCTNVK], [sNS_HSBL]) VALUES (N'16104345-1099-43cf-81ee-226b68af03c8', N'9010003-010-011-7000-7049-0004', N'9010003', N'010', N'011', N'7000', N'7049', N'0004', N'', N'', N'- Kiểm tra, xác minh, giám sát, quản lý đối tượng hưởng tại đơn vị', 0, 1, 0, NULL, 0, 0, 0, 0, 0, 0, 0, 0, 0, N'NG', CAST(N'2024-04-02T12:52:20.930' AS DateTime), CAST(N'2023-11-29T08:59:24.940' AS DateTime), N'STTM', 0, NULL, NULL, NULL, N'd400e9c7-319a-4c0f-b449-a30ac04b8c41', N'a6aa1af6-475c-4853-836f-c0bde339c5b8', 2023, NULL, NULL, N'admin', NULL, NULL, N'TNG', NULL, N'', N'', N'', NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
END 
GO

/****** Object:  StoredProcedure [dbo].[sp_khtm_bhyt_chi_tiet_tonghop_donvi]    Script Date: 4/3/2024 2:44:41 PM ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[sp_khtm_bhyt_chi_tiet_tonghop_donvi]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[sp_khtm_bhyt_chi_tiet_tonghop_donvi]
GO
/****** Object:  StoredProcedure [dbo].[sp_khtm_bhyt_chi_tiet_tonghop_donvi]    Script Date: 4/3/2024 2:44:41 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[sp_khtm_bhyt_chi_tiet_tonghop_donvi]
	@NamLamViec int,
	@MaDonVi nvarchar(MAX)
AS
BEGIN
	SELECT 
		NEWID() as iID_KHTM_BHYT_ChiTiet,
		NEWID() as IdKhtmBHYT,
		NEWID() as iID_KHTM_BHYT,
		'' as iID_MaDonVi,
		'' as sTenDonVi,
		ct.*
	FROM
		(
			SELECT
				bh.sMoTa SMoTa,
				bhct.iID_NoiDung,
				bhct.sTenNoiDung,
				SUM(ISNULL(bhct.iSoNguoi, 0)) as iSoNguoi,
				SUM(ISNULL(bhct.iSoThang, 0)) as iSoThang,
				SUM(ISNULL(bhct.fDinhMuc, 0)) as fDinhMuc,
				SUM(ISNULL(bhct.fThanhTien, 0)) as fThanhTien,
				bhct.sGhiChu,
				bhct.dNgayTao,
				bhct.dNgaySua,
				bhct.sNguoiTao,
				bhct.sNguoiSua,
				bhct.iNamLamViec,
				bhct.sLNS,
				bhct.sXauNoiMa
			FROM 
				BH_KHTM_BHYT bh
			JOIN 
				BH_KHTM_BHYT_ChiTiet bhct ON bh.iID_KHTM_BHYT = bhct.iID_KHTM_BHYT 
			LEFT JOIN 
				(SELECT * FROM DonVi WHERE iNamLamViec = @NamLamViec AND iTrangThai = 1 ) ddv ON bh.iID_MaDonVi = ddv.iID_MaDonVi
			WHERE
				bh.iID_MaDonVi in (SELECT * FROM f_split(@MaDonVi))
			GROUP BY bh.sMoTa, 
				bhct.iID_NoiDung, 
				bhct.sTenNoiDung, 
				bhct.sGhiChu,
				bhct.dNgayTao,
				bhct.dNgaySua,
				bhct.sNguoiTao,
				bhct.sNguoiSua,
				bhct.iNamLamViec,
				bhct.sLNS,
				bhct.sXauNoiMa
		) ct;

END
;
GO
