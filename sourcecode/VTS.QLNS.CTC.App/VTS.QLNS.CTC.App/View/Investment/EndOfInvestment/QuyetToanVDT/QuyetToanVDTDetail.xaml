<Window x:Class="VTS.QLNS.CTC.App.View.Investment.EndOfInvestment.QuyetToanVDT.QuyetToanVDTDetail"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VTS.QLNS.CTC.App.View.Investment.EndOfInvestment.QuyetToanVDT"
        mc:Ignorable="d"
        xmlns:localEnum="clr-namespace:VTS.QLNS.CTC.Utility;assembly=VTS.QLNS.CTC.Utility"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        xmlns:ext="clr-namespace:VTS.QLNS.CTC.App.Extensions"
        xmlns:converters="clr-namespace:VTS.QLNS.CTC.App.Converters"
        xmlns:component="clr-namespace:VTS.QLNS.CTC.App.Component"
        xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
        xmlns:helper="clr-namespace:VTS.QLNS.CTC.App.Helper"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Style="{StaticResource MaterialDesignWindow}"
        Title="{Binding Title}" Height="450" Width="800">
    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}" />
        <KeyBinding Key="F10" Command="{Binding SaveDataCommand}"/>
    </Window.InputBindings>
    <materialDesign:DialogHost
        Identifier="QuyetToanVDTIndex"
        DialogTheme="Inherit">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <StackPanel 
                Grid.Row="0"
                Orientation="Vertical">
                <DockPanel>
                    <materialDesign:PackIcon Kind="Dollar" Style="{StaticResource DialogScreenIconStyle}"/>
                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}Số đề nghị: {0} - Ngày đề nghị: {1} - Năm: {2} | Đơn vị: {3}">
                                        <Binding Path="Model.SSoDeNghi" />
                                        <Binding Path="Model.DNgayDeNghi" Converter="{StaticResource DateTimeToStringConverter}" />
                                        <Binding Path="Model.INamKeHoach" />
                                        <Binding Path="Model.STenDonVi" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Grid>
                    </StackPanel>
                </DockPanel>
                <Separator Background="{DynamicResource MaterialDesignDivider}"/>
            </StackPanel>
            <StackPanel
                Grid.Row="1"
                Orientation="Horizontal">
                <Button 
                    Style="{StaticResource SearchBarBtnStyle}" 
                    IsEnabled="{Binding IsSaveData}"
                    ext:Permission.Identifier="INVESTMENT_IMPLEMENTATION_QUYET_TOAN_VDT_DETAIL_SAVE"
                    Command="{Binding SaveDataCommand}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ContentSave" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Lưu dữ liệu (F10)"/>
                    </StackPanel>
                </Button>
                <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <Button 
                    Style="{StaticResource SearchBarBtnStyle}"
                    ToolTip="Refresh"
                    Command="{Binding RefreshCommand}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Refresh" VerticalAlignment="Center" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Tải lại (F5)"/>
                    </StackPanel>
                </Button>
                <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <Button x:Name="btnShowColSelfPay" Style="{StaticResource SearchBarBtnStyle}" 
                        Visibility="{Binding IsTongHop, Converter={StaticResource BooleanToVisibilityConverter}}"            
                        >
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="PlusMinusVariant" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Ẩn/hiện cột" />
                        <materialDesign:PopupBox
                                    Name="pbDynamicColumnTabOne"
                                    Margin="-10 0 0 0"
                                    HorizontalAlignment="Right"
                                    StaysOpen="True">
                            <materialDesign:PopupBox.Resources>
                                <Style TargetType="ScrollViewer">
                                    <Setter Property="Height" Value="400" />
                                </Style>
                            </materialDesign:PopupBox.Resources>
                            <materialDesign:PopupBox.ToggleContent>
                                <materialDesign:PackIcon Kind="MenuDown"/>
                            </materialDesign:PopupBox.ToggleContent>
                            <ScrollViewer></ScrollViewer>
                        </materialDesign:PopupBox>
                    </StackPanel>
                </Button>
                <Button x:Name="btnShowColSelfPayTabTwo" Style="{StaticResource SearchBarBtnStyle}" 
                        Visibility="{Binding IsPhanTich, Converter={StaticResource BooleanToVisibilityConverter}}"            
                        >
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="PlusMinusVariant" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Ẩn/hiện cột" />
                        <materialDesign:PopupBox
                                    Name="pbDynamicColumnTabTwo"
                                    Margin="-10 0 0 0"
                                    HorizontalAlignment="Right"
                                    StaysOpen="True">
                            <materialDesign:PopupBox.Resources>
                                <Style TargetType="ScrollViewer">
                                    <Setter Property="Height" Value="400" />
                                </Style>
                            </materialDesign:PopupBox.Resources>
                            <materialDesign:PopupBox.ToggleContent>
                                <materialDesign:PackIcon Kind="MenuDown"/>
                            </materialDesign:PopupBox.ToggleContent>
                            <ScrollViewer></ScrollViewer>
                        </materialDesign:PopupBox>
                    </StackPanel>
                </Button>
                <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <ComboBox
                        Name="cbFrozenColumnTabOne"
                        Visibility="{Binding IsTongHop, Converter={StaticResource BooleanToVisibilityConverter}}"
                        materialDesign:HintAssist.Hint="Cố định cột"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                <ComboBox
                        Name="cbFrozenColumnTabTwo"
                        Visibility="{Binding IsPhanTich, Converter={StaticResource BooleanToVisibilityConverter}}"
                        materialDesign:HintAssist.Hint="Cố định cột"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <Button Style="{StaticResource SearchBarBtnStyle}"
                        IsCancel="True">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Close" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Đóng</TextBlock>
                    </StackPanel>
                </Button>
            </StackPanel>

            <StackPanel 
                Grid.Row="2" 
                Margin="0 10 0 0"
                Visibility="{Binding BIsShowPhanTich, Converter={StaticResource BooleanToVisibilityConverter}}" >
                <StackPanel Orientation="Horizontal">
                    <!--<RadioButton
                        x:Name="rbChungTuTongHop"
                        Style="{StaticResource MaterialDesignTabRadioButton}"
                        IsChecked="{Binding TabIndex, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static localEnum:LOAI_BC_QUYET_TOAN.TONG_HOP_SO_LIEU}}"
                        GroupName="TabIndex"
                        Checked="rbChungTuTongHopChecked"
                        Content="Tổng hợp số liệu" />

                    <RadioButton
                        x:Name="rbChungTuPhanTich"
                        Style="{StaticResource MaterialDesignTabRadioButton}"
                        IsChecked="{Binding TabIndex, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static localEnum:LOAI_BC_QUYET_TOAN.PHAN_TICH_SO_LIEU}}"
                        GroupName="TabIndex"
                        Checked="rbChungTuPhanTichChecked"
                        Content="Phân tích số liệu" />-->
                    
                </StackPanel>
                <!--<Separator Background="{DynamicResource MaterialDesignDivider}" Margin="0" />-->
            </StackPanel>


            <TabControl
                Grid.Row="3" 
                    Style="{StaticResource MaterialDesignNavigatilRailTabControl}" 
                    TabStripPlacement="Top" 
                    materialDesign:ColorZoneAssist.Mode="PrimaryLight"
                    SelectedItem="{Binding TabControlIndex, Mode=TwoWay}">
                <TabItem Header="Tổng hợp số liệu"  
                        Style="{StaticResource ExplainTabItemStyle}">
                    <StackPanel>
                        <component:ExpandedDataGrid 
                        Visibility="{Binding isTongHop, Converter={StaticResource BooleanToVisibilityConverter}}"
                        x:Name="dgdQuyetToanVDTDetailTongHop"
                        Grid.Row="3"
                        Margin="0 5 0 0"
                        VerticalAlignment="Top"
                        BorderThickness="1"
                        AutoGenerateColumns="False"
                        IsReadOnly="{Binding BIsDetail}"
                        CanUserResizeColumns="True"
                        CanUserDeleteRows="False"
                        ScrollViewer.CanContentScroll="True"
                        FrozenColumnCount="1"
                        CanUserAddRows="False"
                        BeginningEdit="DgdData_BeginningEdit"
                        GridLinesVisibility="All"
                        EnableFooterDataGrid="True"
                        EnableHeaderDataGrid="True"
                        Style="{StaticResource MultilHeaderDataGrid}"
                        CellStyle="{StaticResource DataGridCellDetail}"
                        RowStyle="{StaticResource DataGridRowDetail}"
                        ElementFrozenColumn="{Binding ElementName=cbFrozenColumnTabOne, Path=., Mode=TwoWay}"
                        ElementDynamicColumn="{Binding ElementName=pbDynamicColumnTabOne, Path=., Mode=TwoWay}"
                        SelectedItem="{Binding SelectedItem}"
                        ItemsSource="{Binding Items}">  
                            <DataGrid.Resources>
                                <helper:BindingProxy
                            x:Key="DataContextProxy"
                            Data="{Binding}" />
                                <Style TargetType="ComboBox" BasedOn="{StaticResource {ComponentResourceKey TypeInTargetAssembly={x:Type ComboBox}, ResourceId=MaterialDataGridComboBoxColumnEditingStyle}}" >
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <component:DataGridTextColumn 
                                x:Name="sTenDuAn"
                                IsReadOnly="True"
                                Header="Nội dung&#x0a; (2)"
                                HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                                Binding="{Binding STenDuAn}" 
                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                                <component:DataGridTextColumn 
                                x:Name="sLoaiCongTrinh"
                                IsReadOnly="True"
                                Header="Loại công trình &#x0a;"
                                HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                                Binding="{Binding STenLoaiCongTrinh}" 
                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                                <!--<component:DataGridTextColumn 
                            x:Name="sDiaDiem"
                            IsReadOnly="True" 
                            Header="Địa điểm mở tài khoản&#x0a;  (2)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding SDiaDiem}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                        <component:DataGridTextColumn 
                            x:Name="sMaDuAn"
                            IsReadOnly="True" 
                            Header="Mã dự án đầu tư&#x0a;  (3)" 
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding SMaDuAn}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>-->
                                <component:DataGridTextColumn 
                            x:Name="fTongMucDauTu" 
                            Width="140"
                            IsReadOnly="True"
                            Header="Tổng mức đầu tư&#x0a; (3)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongMucDauTu, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                                <component:DataGridTextColumn  
                            Width="250"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            Header="Tổng số&#x0a; (4)"
                            ColumnSpan="2"
                            ColumnSpanTitle="Luỹ kế vốn đã thanh toán từ K/C đến hết niên độ năm trước năm quyết toán"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FLuyKeThanhToanNamTruoc, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}">
                                </component:DataGridTextColumn>
                                <component:DataGridTextColumn  
                            x:Name="fTamUngTheoCheDoChuaThuHoiNamTruoc"
                            Width="250"
                            StringFormat="{}{0:N0}"
                            IsReadOnly="True"
                            ColumnSpan="0"
                            Header="(5)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTamUngTheoCheDoChuaThuHoiNamTruoc, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fGiaTriTamUngDieuChinhGiam"
                            Width="140"
                            StringFormat="{}{0:N0}"
                            Header="(6)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FGiaTriTamUngDieuChinhGiam, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}, UpdateSourceTrigger=LostFocus}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}" 
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}">
                                </component:DataGridTextColumn>
                                <materialDesign:DataGridTextColumn  
                            x:Name="fTamUngNamTruocThuHoiNamNay"
                            Width="140"
                            IsReadOnly="True" 
                            Header="(7)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTamUngNamTruocThuHoiNamNay, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}">
                                </materialDesign:DataGridTextColumn>
                                <component:DataGridTextColumn  
                            x:Name="fKHVNamTruocChuyenNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="6"
                            ColumnSpanTitle="{Binding Data.sKeHoachThanhToanVon, Source={StaticResource DataContextProxy}}"
                            Header="(8)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FKHVNamTruocChuyenNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}">
                                </component:DataGridTextColumn>
                                <component:DataGridTextColumn  
                            x:Name="fTongThanhToanVonKeoDaiNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="Tổng số&#x0a; (9)=(10)+(11)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongThanhToanVonKeoDaiNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fTongThanhToanSuDungVonNamTruoc"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(10)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongThanhToanSuDungVonNamTruoc, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fTamUngTheoCheDoChuaThuHoiKeoDaiNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(11)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTamUngTheoCheDoChuaThuHoiKeoDaiNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fGiaTriNamTruocChuyenNamSau"
                            Width="140"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(12)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FGiaTriNamTruocChuyenNamSau, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fVonConLaiHuyBoKeoDaiNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(13)=(8)-(9)-(12)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FVonConLaiHuyBoKeoDaiNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fKHVNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="6"
                            ColumnSpanTitle="{Binding Data.sKeHoachThanhToanVonNamNay, Source={StaticResource DataContextProxy}}"
                            Header="(14)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FKHVNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}">
                                </component:DataGridTextColumn>
                                <component:DataGridTextColumn  
                            x:Name="fTongKeHoachThanhToanVonNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="Tổng số&#x0a; (15)=(16)+(17)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongKeHoachThanhToanVonNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fTongThanhToanSuDungVonNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(16)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongThanhToanSuDungVonNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fTamUngTheoCheDoChuaThuHoiNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(17)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTamUngTheoCheDoChuaThuHoiNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fGiaTriNamNayChuyenNamSau"
                            Width="140"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(18)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FGiaTriNamNayChuyenNamSau, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <component:DataGridTextColumn  
                            x:Name="fVonConLaiHuyBoNamNay"
                            Width="140"
                            IsReadOnly="True"
                            StringFormat="{}{0:N0}"
                            ColumnSpan="0"
                            Header="(19)=(14)-(15)-(18)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FVonConLaiHuyBoNamNay, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                                <materialDesign:DataGridTextColumn  
                            x:Name="fTongVonThanhToanNamNay"
                            Width="180"
                            IsReadOnly="True"
                            Header="(20)=(7)+(10)+(16)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FTongVonThanhToanNamNay, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}">
                                </materialDesign:DataGridTextColumn>
                                <materialDesign:DataGridTextColumn  
                            x:Name="fLuyKeTamUngChuaThuHoiChuyenSangNam"
                            Width="180"
                            IsReadOnly="True"
                            Header="(21)=(5)-(6)-(7)+(11)+(17)" 
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FLuyKeTamUngChuaThuHoiChuyenSangNam, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}">
                                </materialDesign:DataGridTextColumn>
                                <materialDesign:DataGridTextColumn  
                            x:Name="fLuyKeConDaThanhToanHetNamNay"
                            Width="140"
                            Header="(22)"
                            HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                            Binding="{Binding FLuyKeConDaThanhToanHetNamNay, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            IsReadOnly="True">
                                </materialDesign:DataGridTextColumn>
                            </DataGrid.Columns>
                        </component:ExpandedDataGrid>
                        <StackPanel Visibility="Visible" Margin="5 10 10 5">
                            <TextBlock FontWeight="Bold">Chú thích:</TextBlock>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                    <ColumnDefinition Width="10"></ColumnDefinition>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                    <ColumnDefinition Width="10"></ColumnDefinition>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Column="0" Grid.Row="0"><TextBlock Foreground="red">(5):</TextBlock> Trong đó vốn tạm ứng theo chế độ chưa thu hồi</TextBlock>
                                <TextBlock Grid.Column="2" Grid.Row="0"><TextBox IsReadOnly="True" Foreground="red">(6):</TextBox> <TextBlock TextWrapping="Wrap" Text="{Binding sVonTamUngChuaThuHoi}" /></TextBlock>
                                <TextBlock Grid.Column="4" Grid.Row="0"><TextBox IsReadOnly="True" VerticalAlignment="Stretch" Foreground="red">(7):</TextBox>  <TextBlock TextWrapping="Wrap"  Text="{Binding sThanhToanVonTamUng}" /></TextBlock>
                                <TextBlock Grid.Column="0" Grid.Row="1"><TextBlock Foreground="red">(8):</TextBlock> Dự toán năm trước được kéo dài</TextBlock>
                                <TextBlock Grid.Column="2" Grid.Row="1"><TextBlock Foreground="red">(10):</TextBlock> Thanh toán KLHT</TextBlock>
                                <TextBlock Grid.Column="4" Grid.Row="1"><TextBlock Foreground="red">(11):</TextBlock> Vốn tạm ứng</TextBlock>
                                <TextBlock Grid.Column="0" Grid.Row="2"><TextBlock Foreground="red">(12):</TextBlock> <TextBlock TextWrapping="Wrap">Dự toán đề nghị kéo dài thời gian thực hiện và giải ngân sang năm sau năm quyết toán (nếu có)</TextBlock></TextBlock>
                                <TextBlock Grid.Column="2" Grid.Row="2"><TextBlock Foreground="red">(13):</TextBlock> Số vốn còn lại chưa giải ngân hủy bỏ (nếu có)</TextBlock>
                                <TextBlock Grid.Column="4" Grid.Row="2"><TextBlock Foreground="red">(14):</TextBlock> <TextBlock Text="{Binding sVonDaQuyetToanTrongNam}" /></TextBlock>
                                <TextBlock Grid.Column="0" Grid.Row="3"><TextBlock Foreground="red">(16):</TextBlock> Thanh toán KLHT</TextBlock>
                                <TextBlock Grid.Column="2" Grid.Row="3"><TextBlock Foreground="red">(17):</TextBlock> Vốn tạm ứng</TextBlock>
                                <TextBlock Grid.Column="4" Grid.Row="3"><TextBlock Foreground="red">(18):</TextBlock> <TextBlock TextWrapping="Wrap">Dự toán  đề nghị kéo dài thời gian thực hiện và giải ngân sang năm sau năm quyết toán (nếu có)</TextBlock></TextBlock>
                                <TextBlock Grid.Column="0" Grid.Row="4"><TextBlock Foreground="red">(19):</TextBlock> <TextBlock TextWrapping="Wrap">Số vốn còn lại chưa giải ngân hủy bỏ (nếu có)</TextBlock></TextBlock>
                                <TextBlock Grid.Column="2" Grid.Row="4"><TextBlock Foreground="red">(20):</TextBlock> <TextBlock TextWrapping="Wrap">Tổng số vốn đã thanh toán KLHT được quyết toán trong năm quyết toán</TextBlock></TextBlock>
                                <TextBlock Grid.Column="4" Grid.Row="4"><TextBlock Foreground="red">(21):</TextBlock> <TextBlock TextWrapping="Wrap">Luỹ kế số vốn tạm ứng theo chế độ chưa thu hồi đến hết năm quyết toán chuyển sang các năm sau </TextBlock></TextBlock>
                                <TextBlock Grid.Column="0" Grid.Row="5"><TextBlock Foreground="red">(22):</TextBlock>  <TextBlock Text="{Binding sLuyKeVonDaThanhToan}" /></TextBlock>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </TabItem>

                <TabItem Header="Phân tích số liệu" 
                        Style="{StaticResource ExplainTabItemStyle}">
                    <component:ExpandedDataGrid               
                        Visibility="{Binding isPhanTich, Converter={StaticResource BooleanToVisibilityConverter}}"
                        x:Name="dgdQuyetToanVDTDetailPhanTich"
                        Grid.Row="3"
                        Margin="0 5 0 0"
                        VerticalAlignment="Top"
                        BorderThickness="1"
                        AutoGenerateColumns="False"
                        IsReadOnly="{Binding BIsDetail}"
                        CanUserResizeColumns="True"
                        CanUserDeleteRows="False"                
                        BeginningEdit="DgdData_BeginningEdit"
                        ScrollViewer.CanContentScroll="True"
                        FrozenColumnCount="1"
                        CanUserAddRows="False"
                        GridLinesVisibility="All"
                        EnableFooterDataGrid="True"
                        EnableHeaderDataGrid="True"
                        Style="{StaticResource MultilHeaderDataGrid}"
                        CellStyle="{StaticResource DataGridCellDetail}"
                        RowStyle="{StaticResource DataGridRowDetail}"
                        ElementFrozenColumn="{Binding ElementName=cbFrozenColumnTabTwo, Path=., Mode=TwoWay}"
                        ElementDynamicColumn="{Binding ElementName=pbDynamicColumnTabTwo, Path=., Mode=TwoWay}"
                        SelectedItem="{Binding SelectedPhanTich}"
                        ItemsSource="{Binding ItemsPhanTich}">  
                        <DataGrid.Resources>
                            <helper:BindingProxy
                        x:Key="DataContextProxy"
                        Data="{Binding}" />
                            <Style TargetType="ComboBox" BasedOn="{StaticResource {ComponentResourceKey TypeInTargetAssembly={x:Type ComboBox}, ResourceId=MaterialDataGridComboBoxColumnEditingStyle}}" >
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        Header="Tên dự án, công trình"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding STenDuAn}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        Header="Loại công trình"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding STenLoaiCongTrinh}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True" 
                        Header="Dự toán còn dư tại kho bạc" 
                        ColumnSpan="4"
                        ColumnSpanTitle="Năm trước chuyển sang (nếu có)"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiKbNamTruoc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        ColumnSpan="0"
                        Header="Tồn khoản tại đơn vị"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiDvNamTruoc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        ColumnSpan="0"
                        Header="Dự toán còn dư tại Cục Tài chính"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiCucNamTruoc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        Header="Đã tạm ứng theo chế độ chưa thu hồi"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FTongChuaThuHoi, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True" 
                        Header="Giao dự toán tại kho bạc" 
                        ColumnSpan="3"
                        ColumnSpanTitle="Dự toán được giao"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FChiTieuNamNayKb, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        ColumnSpan="0"
                        Header="Cấp bằng ủy nhiệm chi"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FChiTieuNamNayLc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        Header="Tổng cộng"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FTongDuToanDuocGiao, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        Header="Năm trước chuyển sang (nếu có)" 
                        ColumnSpan="3"
                        ColumnSpanTitle="Số được cấp"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FSoCapNamTrcCs, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Năm nay"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FSoCapNamNay, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        ColumnSpan="0"
                        Header="Cộng"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FSumSoDuocCap, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        Header="Năm trước chuyển sang (nếu có)" 
                        ColumnSpan="3"
                        ColumnSpanTitle="Số đề nghị quyết toán"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDnQuyetToanNamTrc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Năm nay"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDnQuyetToanNamNay, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        ColumnSpan="0"
                        Header="Cộng"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FSumSoQuyetToan, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        IsReadOnly="True"
                        Header="Tổng số"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FTongChuyenNamSau, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                            <component:DataGridTextColumn 
                        Header="Cục Tài chính cấp tạm ứng chưa thu hồi" 
                        ColumnSpan="2"
                        ColumnSpanTitle="Tạm ứng theo chế độ chưa thu hồi"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FTuChuaThuHoiTaiCuc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Số tạm ứng chưa thu hồi do đơn vị cấp theo ủy quyền"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FTuChuaThuHoiTaiDonVi, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Tại Cục Tài chính" 
                        ColumnSpan="3"
                        ColumnSpanTitle="Dự toán còn dư chưa giải ngân"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiCuc, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                            <component:DataGridTextColumn 
                        Header="Tồn khoản tại đơn vị"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiDv, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Tại Kho bạc"
                        ColumnSpan="0"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanCnsChuaGiaiNganTaiKb, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                            <component:DataGridTextColumn 
                        Header="Dự toán thu hồi do hết nhiệm vụ"
                        HeaderStyle="{StaticResource DataGridColumnHeaderWrap}"
                        Binding="{Binding FDuToanThuHoi, Converter={ StaticResource NumberToStringEmptyConverter}, StringFormat={}{0:N0}}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"/>
                        </DataGrid.Columns>
                    </component:ExpandedDataGrid>

                </TabItem>
            </TabControl>





            

            
        </Grid>
    </materialDesign:DialogHost>
</Window>
