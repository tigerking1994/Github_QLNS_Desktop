<Window
    x:Class="VTS.QLNS.CTC.App.View.Investment.InvestmentImplementation.CapPhatThanhToan.CapPhatThanhToanDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:VTS.QLNS.CTC.App.View.Investment.InvestmentImplementation.CapPhatThanhToan"
    mc:Ignorable="d"
    xmlns:system="clr-namespace:System;assembly=mscorlib"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
    xmlns:custom="clr-namespace:VTS.QLNS.CTC.Custom;assembly=VTS.QLNS.CTC.Custom"
    xmlns:ext="clr-namespace:VTS.QLNS.CTC.App.Extensions"
    xmlns:helper="clr-namespace:VTS.QLNS.CTC.App.Helper"
    xmlns:component="clr-namespace:VTS.QLNS.CTC.App.Component"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    Style="{StaticResource MaterialDesignWindow}"
    WindowStartupLocation="CenterScreen"
    WindowState="Maximized"
    Title="{Binding Title}">
    <materialDesign:DialogHost
        Identifier="CapPhatThanhToanDialog"
        DialogTheme="Inherit">
        <Grid
            Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition
                    Height="Auto" />
                <RowDefinition
                    Height="*" />
                <RowDefinition
                    Height="Auto" />
            </Grid.RowDefinitions>
            <StackPanel>
                <DockPanel>
                    <materialDesign:PackIcon
                        Kind="PlaylistPlus"
                        Style="{StaticResource DialogScreenIconStyle}" />
                    <StackPanel
                        Orientation="Vertical"
                        VerticalAlignment="Center"
                        Margin="10 0">
                        <TextBlock
                            Text="{Binding Title}"
                            FontWeight="Bold"></TextBlock>
                        <TextBlock
                            Text="{Binding Description}"></TextBlock>
                    </StackPanel>
                </DockPanel>
                <Separator
                    Background="{DynamicResource MaterialDesignDivider}" />
            </StackPanel>
            <ScrollViewer
                Grid.Row="1"
                Margin="-4 0 -4 0"
                VerticalScrollBarVisibility="Auto"
                HorizontalScrollBarVisibility="Disabled">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="1*"
                            MinWidth="250" />
                        <ColumnDefinition
                            Width="1*"
                            MinWidth="250" />
                        <ColumnDefinition
                            Width="2*"
                            MinWidth="500" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                        <RowDefinition
                            Height="auto" />
                    </Grid.RowDefinitions>
                    <Grid.Resources>
                        <Style
                            TargetType="custom:AutoCompleteComboBox"
                            BasedOn="{StaticResource MaterialDesignFloatingHintComboBox}">
                            <Setter
                                Property="materialDesign:HintAssist.IsFloating"
                                Value="True" />
                            <Setter
                                Property="HorizontalAlignment"
                                Value="Stretch" />
                            <Setter
                                Property="VerticalAlignment"
                                Value="Center" />
                        </Style>
                    </Grid.Resources>
                    <TextBlock
                        Grid.Row="0"
                        Grid.ColumnSpan="2"
                        FontWeight="Bold">THÔNG TIN CHUNG</TextBlock>

                    <custom:AutoCompleteComboBox
                        Grid.Row="1"
                        Grid.Column="0"
                        x:Uid="cbxDonViQuanLy"
                        Margin="0 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Đơn vị"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding CbxLoaiDonViSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding CbxLoaiDonVi}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />
                    <custom:AutoCompleteComboBox
                        Grid.Row="1"
                        Grid.Column="1"
                        x:Uid="cbxChuDauTu"
                        Margin="0 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Chủ đầu tư"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding ChuDauTuSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataChuDauTu}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />

                    <custom:AutoCompleteComboBox
                        Grid.Row="2"
                        Grid.Column="0"
                        Margin="0 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Dự án"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding DuAnSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataDuAn}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />

                    <custom:AutoCompleteComboBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="0 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Hạng mục dự án"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding DuAnHangMucSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataDuAnHangMuc}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />

                    <TextBox
                        Grid.Row="3"
                        Grid.Column="0"
                        Margin="0 2 10 2"
                        VerticalAlignment="Center"
                        materialDesign:HintAssist.Hint="Số đề nghị"
                        Text="{Binding Model.sSoDeNghi}"
                        IsEnabled="False"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                    <DatePicker
                        Grid.Row="3"
                        Grid.Column="1"
                        Language="vi-VN"
                        Margin="10 2 10 2"
                        materialDesign:HintAssist.Hint="Ngày đề nghị"
                        IsEnabled="{Binding BIsNotApprove}"
                        SelectedDate="{Binding DNgayDeNghi}"
                        Style="{StaticResource MaterialDesignFloatingHintDatePicker}" />

                    <!--<TextBox
                Grid.Row="4"
                Grid.Column="0"
                Width="300"
                Margin="0 2 10 2"
                VerticalAlignment="Center" 
                materialDesign:HintAssist.Hint="Số căn cứ bảng xác định KLHT"
                Text="{Binding Model.SSoBangKlht}"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>-->
                    <TextBox
                        Grid.Row="4"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="0 2 10 2"
                        VerticalAlignment="Center"
                        materialDesign:HintAssist.Hint="Thông tin căn cứ"
                        Text="{Binding Model.sThongTinCanCu }"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                        IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                    <!--<DatePicker
                Grid.Row="4"
                Grid.Column="1"
                Language="vi-VN"
                Width="300"
                Margin="10 2 10 2"
                materialDesign:HintAssist.Hint="Ngày căn cứ"
                IsEnabled="{Binding BIsNotApprove}"
                SelectedDate="{Binding Model.DNgayBangKlht}"
                Style="{StaticResource MaterialDesignFloatingHintDatePicker}"/>-->

                    <TextBox
                        Grid.Row="5"
                        Grid.Column="0"
                        Margin="0 2 10 2"
                        VerticalAlignment="Center"
                        materialDesign:HintAssist.Hint="Luỹ kế giá trị khối lượng nghiệm thu"
                        Text="{Binding Model.FLuyKeGiaTriNghiemThuKlht, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                        IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />

                    <CheckBox
                        Grid.Row="5"
                        Grid.Column="1"
                        Margin="10 2 10 2"
                        IsEnabled="{Binding IsInsert}"
                        IsChecked="{Binding BThanhToanTheoHopDong, UpdateSourceTrigger=PropertyChanged}"
                        Content="Thanh toán theo hợp đồng" />

                    <custom:AutoCompleteComboBox
                        Grid.Row="7"
                        Visibility="{Binding BThanhToanTheoHopDong, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Grid.ColumnSpan="2"
                        IsEditable="True"
                        Margin="0 2 10 2"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Hợp đồng"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding HopDongSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataHopDong}"
                        IsEnabled="{Binding BIsNotApprove}" />
                    <component:ExpandedDataGrid
                        Margin="0 2 10 2"
                        Visibility="{Binding BThanhToanTheoHopDong, Converter={StaticResource InvertBooleanToVisibilityConverter}}"
                        Grid.Row="7"
                        Grid.ColumnSpan="2"
                        FrozenColumnCount="0"
                        MinWidth="300"
                        MaxHeight="400"
                        BorderThickness="1"
                        IsReadOnly="{Binding BIsNotApprove, Converter={StaticResource InvertBooleanConverter}}"
                        CanUserResizeColumns="True"
                        CanUserAddRows="False"
                        IsSynchronizedWithCurrentItem="True"
                        GridLinesVisibility="All"
                        RowStyle="{StaticResource DataGridRowIndex}"
                        Style="{StaticResource MaterialDesignDataGrid}"
                        ItemsSource="{Binding ItemsChiPhi, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        SelectedItem="{Binding SelectedChiPhi}"
                        ext:DataGridBehavior.LastColumnFill="True"
                        AutoGenerateColumns="False">
                        <DataGrid.Resources>
                            <helper:BindingProxy
                                x:Key="DataContextProxy"
                                Data="{Binding}" />
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn
                                Binding="{Binding IsChecked,UpdateSourceTrigger=PropertyChanged}"
                                ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}">
                                <DataGridCheckBoxColumn.HeaderStyle>
                                    <Style
                                        TargetType="{x:Type DataGridColumnHeader}"
                                        BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                        <Setter
                                            Property="HorizontalContentAlignment"
                                            Value="Center" />
                                    </Style>
                                </DataGridCheckBoxColumn.HeaderStyle>
                            </DataGridCheckBoxColumn>
                            <DataGridTextColumn
                                Header="Tên chi phí"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailLeftStyle}"
                                Binding="{Binding STenChiPhi}" />
                            <DataGridTextColumn
                                Header="Giá trị QĐ đầu tư"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                Binding="{Binding FGiaTriPheDuyetQdDauTu, StringFormat={}{0:N0}}" />
                            <DataGridTextColumn
                                Header="Giá trị dự toán"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                Binding="{Binding FGiaTriPheDuyetDuToan, StringFormat={}{0:N0}}" />
                        </DataGrid.Columns>
                    </component:ExpandedDataGrid>

                    <TextBox
                        Visibility="{Binding BThanhToanTheoHopDong, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Grid.Row="8"
                        Grid.Column="0"
                        Margin="0 2 10 2"
                        VerticalAlignment="Center"
                        IsReadOnly="True"
                        FontWeight="Bold"
                        IsEnabled="{Binding IsInsert}"
                        materialDesign:HintAssist.Hint="Giá trị hợp đồng"
                        Text="{Binding GiaTriHopDong, StringFormat={}{0:N0}}"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                    <custom:AutoCompleteComboBox
                        Visibility="{Binding BThanhToanTheoHopDong, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Grid.Row="8"
                        Grid.Column="1"
                        IsEditable="True"
                        Margin="10 2 10 2"
                        TextSearch.TextPath="STenNhaThau"
                        DisplayMemberPath="STenNhaThau"
                        materialDesign:HintAssist.Hint="Nhà thầu"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding NhaThauSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding NhaThauItems}"
                        IsEnabled="{Binding BIsNotApprove}" />

                    <custom:AutoCompleteComboBox
                        Grid.Row="9"
                        Grid.Column="0"
                        IsEditable="True"
                        Margin="0 2 10 2"
                        IsEnabled="{Binding BIsChangePaymentType}"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Loại thanh toán"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding CbxLoaiThanhToanSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding CbxLoaiThanhToan}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}" />
                    <!--<TextBox
                Grid.Row="9"
                Grid.Column="0"
                Width="300"
                Margin="0 2 10 2"
                materialDesign:HintAssist.Hint="Người lập"
                Text="{Binding Model.sNguoiLap}"
                VerticalAlignment="Center"
                Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>-->
                    <TextBox
                        Grid.Row="9"
                        Grid.Column="1"
                        Margin="10 2 10 2"
                        materialDesign:HintAssist.Hint="Năm kế hoạch"
                        IsEnabled="{Binding BIsNotApprove}"
                        VerticalAlignment="Center"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                        PreviewTextInput="NumberValidationTextBox"
                        MaxLength="4">

                        <TextBox.Text>
                            <Binding
                                Path="INamKeHoach"
                                UpdateSourceTrigger="PropertyChanged"
                                Mode="TwoWay"
                                TargetNullValue="{x:Static sys:String.Empty}">
                                <Binding.ValidationRules>
                                    <helper:CharacterLimitRule
                                        MiniumCharacter="4"
                                        ErrorMessage="Không đúng định dạng năm!" />
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>

                    </TextBox>

                    <custom:AutoCompleteComboBox
                        Grid.Row="10"
                        Grid.Column="0"
                        Margin="0 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Nguồn vốn"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding NguonVonSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataNguonVon}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />
                    <custom:AutoCompleteComboBox
                        Grid.Row="10"
                        Grid.Column="1"
                        Margin="10 2 10 2"
                        IsEditable="True"
                        TextSearch.TextPath="DisplayItem"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        materialDesign:HintAssist.Hint="Cơ quan thanh toán"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        SelectedItem="{Binding CoQuanThanhToanSelected, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DataCoQuanThanhToan}"
                        Visibility="{Binding AgregateVisibility, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{Binding BIsNotApprove}" />
                    <CheckBox
                        Grid.Row="11"
                        Visibility="{Binding BIsVisibleHoanTraUngTruoc, Converter={StaticResource BooleanToVisibilityConverter}}"
                        IsChecked="{Binding BHoanTraUngTruoc, UpdateSourceTrigger=PropertyChanged}"
                        Content="{Binding SHoanTraUngTruoc}" />
                    <TextBlock
                        Grid.Row="12"
                        Grid.ColumnSpan="2"
                        FontWeight="Bold"
                        Margin="0 10 0 0">Kế hoạch vốn</TextBlock>
                    <component:ExpandedDataGrid
                        Margin="0 2 10 2"
                        Grid.Row="13"
                        Grid.ColumnSpan="2"
                        x:Name="dgdCapPhatThanhToanDialog"
                        FrozenColumnCount="0"
                        MinWidth="300"
                        BorderThickness="1"
                        CanUserResizeColumns="True"
                        HorizontalScrollBarVisibility="Visible"
                        CanUserAddRows="False"
                        IsSynchronizedWithCurrentItem="True"
                        GridLinesVisibility="All"
                        RowStyle="{StaticResource DataGridRowIndex}"
                        Style="{StaticResource MaterialDesignDataGrid}"
                        ItemsSource="{Binding ListKeHoachVon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        ext:DataGridBehavior.LastColumnFill="True"
                        AutoGenerateColumns="False">
                        <DataGrid.Resources>
                            <helper:BindingProxy
                                x:Key="DataContextProxy"
                                Data="{Binding}" />
                        </DataGrid.Resources>
                        <DataGrid.Columns>

                            <DataGridCheckBoxColumn
                                IsReadOnly="False"
                                Binding="{Binding IsChecked,UpdateSourceTrigger=PropertyChanged}"
                                ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}">
                                <DataGridCheckBoxColumn.HeaderStyle>
                                    <Style
                                        TargetType="{x:Type DataGridColumnHeader}"
                                        BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                        <Setter
                                            Property="HorizontalContentAlignment"
                                            Value="Center" />
                                    </Style>
                                </DataGridCheckBoxColumn.HeaderStyle>
                            </DataGridCheckBoxColumn>
                            <DataGridTextColumn
                                Width="250"
                                Header="Tên loại"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailLeftStyle}"
                                Binding="{Binding TenLoai}"></DataGridTextColumn>
                            <DataGridTextColumn
                                Width="200"
                                Header="Số quyết định"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailLeftStyle}"
                                Binding="{Binding SSoQuyetDinh}"></DataGridTextColumn>
                            <DataGridTextColumn
                                Width="150"
                                Header="Ngày quyết định"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailCenterStyle}"
                                Binding="{Binding DNgayQuyetDinh, Converter={StaticResource DateTimeToStringConverter}}"></DataGridTextColumn>
                            <DataGridTextColumn
                                Width="200"
                                Header="Vốn bố trí"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                Binding="{Binding FTongGiaTri, StringFormat={}{0:N0}}"></DataGridTextColumn>
                            <DataGridTextColumn
                                Width="200"
                                Header="Lũy kế đã thanh toán"
                                IsReadOnly="True"
                                ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                Binding="{Binding FLuyKeThanhToan, StringFormat={}{0:N0}}"></DataGridTextColumn>
                        </DataGrid.Columns>
                    </component:ExpandedDataGrid>

                    <component:AttachmentForm
                        Grid.Row="14"
                        Grid.ColumnSpan="2"
                        Margin="0 10 0 0" />

                    <!--<TextBlock
                Grid.Row="15"
                Grid.ColumnSpan="2"
                FontWeight="Bold"
                Margin="0 10 0 0">Thông tin căn cứ</TextBlock>
            <StackPanel
                Orientation="Horizontal"
                Grid.Row="16"
                Margin="0 3 0 0">
                <Button
                    Style="{StaticResource SearchBarBtnStyle}"
                    Command="{Binding AddThongTinCanCuCommand}">
                    <StackPanel
                        Orientation="Horizontal">
                        <materialDesign:PackIcon
                            Kind="Plus" />
                        <TextBlock
                            Style="{StaticResource SearchBarBtnTextStyle}"
                            Text="Tạo mới (F3)" />
                    </StackPanel>
                </Button>
                <Separator
                    Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <Button
                    Style="{StaticResource SearchBarBtnStyle}"
                    Command="{Binding DeleteThongTinCanCuCommand}"
                    CommandParameter="{Binding ElementName=dgdData, Path=.}"
                    ToolTip="Xóa dữ liệu">
                    <StackPanel
                        Orientation="Horizontal">
                        <materialDesign:PackIcon
                            Kind="Delete" />
                        <TextBlock
                            Style="{StaticResource SearchBarBtnTextStyle}"
                            Text="Xóa (F4)" />
                    </StackPanel>
                </Button>
            </StackPanel>
            <Border
                Grid.Row="17"
                Margin="0 5 0 0"
                Grid.ColumnSpan="2">
                <DataGrid
                    x:Name="dgdThongTinCanCu"
                    MaxHeight="250"
                    BorderThickness="1"
                    CanUserResizeColumns="True"
                    CanUserAddRows="False"
                    AutoGenerateColumns="False"
                    FrozenColumnCount="1"
                    VerticalAlignment="Top"
                    GridLinesVisibility="All"
                    HorizontalScrollBarVisibility="Disabled"
                    IsSynchronizedWithCurrentItem="True"
                    Width="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualWidth}"
                    Style="{StaticResource MaterialDesignDataGrid}"
                    CellStyle="{StaticResource DataGridCellDetail}"
                    RowStyle="{StaticResource DataGridRowDetail}"
                    ItemsSource="{Binding ThongTinCanCuItems, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding ThongTinCanCuSelected}"
                    ext:DataGridBehavior.LastColumnFill="True">
                    <DataGrid.Resources>
                        <Style
                            TargetType="{x:Type ComboBox}"
                            BasedOn="{StaticResource {ComponentResourceKey ResourceId=MaterialDataGridComboBoxColumnEditingStyle, TypeInTargetAssembly={x:Type ComboBox}}}" />
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <component:DataGridTextColumn
                            Header="STT"
                            Width="60"
                            FontWeight="Bold"
                            ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                            IsReadOnly="True"
                            Binding="{Binding iSTT, UpdateSourceTrigger=LostFocus}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}"></component:DataGridTextColumn>
                        <DataGridTextColumn
                            Header="Nội dung căn cứ"
                            Width="600"
                            ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                            Binding="{Binding sNoiDung, UpdateSourceTrigger=LostFocus}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}"></DataGridTextColumn>
                        <component:DataGridTextColumn
                            Header="Giá trị"
                            Width="*"
                            StringFormat="{}{0:N0}"
                            ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                            Binding="{Binding fGiaTri, StringFormat={}{0:N0}}"
                            EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"></component:DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>-->

                    <StackPanel
                        Grid.Column="2"
                        Grid.RowSpan="20"
                        Margin="40 0 4 0">
                        <!-- Thong tin thanh toan -->
                        <TextBlock
                            FontWeight="Bold"
                            Grid.Row="15"
                            Grid.Column="0"
                            Margin="0 2 10 2">THÔNG TIN THANH TOÁN</TextBlock>
                        <!--<TextBlock FontWeight="Bold" Grid.Row="16" Grid.Column="0" Margin="0 2 10 2">Lũy kế thanh toán</TextBlock>
            <TextBlock FontWeight="Bold" Grid.Column="1" Grid.Row="16" Margin="0 2 10 2">Lũy kế tạm ứng chưa thu hồi theo chế độ</TextBlock>-->
                        <Grid
                            Grid.Row="17">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                            </Grid.RowDefinitions>
                            <TextBlock
                                FontWeight="Bold"
                                Grid.ColumnSpan="1"
                                Grid.Row="0"
                                Margin="0 2 10 2"
                                Visibility="{Binding BThanhToanTheoHopDong, Converter= {StaticResource BooleanToVisibilityConverter}}">Tỷ lệ thanh toán</TextBlock>
                            <TextBlock
                                FontWeight="Bold"
                                Grid.ColumnSpan="2"
                                Grid.Row="0"
                                Grid.Column="{Binding IndexForLuyKeThanhToanKLHTTrongNuoc}"
                                Margin="0 2 10 2">Lũy kế thanh toán KLHT</TextBlock>
                            <TextBox
                                Grid.Column="0"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Tỷ lệ thanh toán"
                                Text="{Binding FTyLeThanhToan}"
                                IsReadOnly="True"
                                Visibility="{Binding BThanhToanTheoHopDong, Converter= {StaticResource BooleanToVisibilityConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                            <TextBox
                                Grid.Column="{Binding IndexForLuyKeThanhToanKLHTTrongNuoc}"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding LuyKeThanhToanKLHTVonTN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                            <TextBox
                                Grid.Column="{Binding IndexForLuyKeThanhToanKLHTNgoaiNuoc}"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding LuyKeThanhToanKLHTVonNN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                        </Grid>
                        <Grid
                            Grid.Row="18"
                            Grid.ColumnSpan="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                                <ColumnDefinition
                                    Width="225"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                            </Grid.RowDefinitions>
                            <TextBlock
                                FontWeight="Bold"
                                Grid.ColumnSpan="2"
                                Grid.Column="0"
                                Grid.Row="0"
                                Margin="0 10 10 2">Lũy kế tạm ứng chưa thu hồi theo chế độ</TextBlock>
                            <TextBlock
                                FontWeight="Bold"
                                Grid.ColumnSpan="2"
                                Grid.Column="2"
                                Grid.Row="0"
                                Margin="0 10 10 2">Lũy kế tạm ứng chưa thu hồi (ứng trước)</TextBlock>
                            <TextBox
                                Grid.Column="2"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding LuyKeTamUngChuaThuHoiVonUngTruocTN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                            <TextBox
                                Grid.Column="3"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding LuyKeTamUngChuaThuHoiVonUngTruocNN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />

                            <TextBox
                                Grid.Column="0"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding LuyKeTamUngChuaThuHoiVonTN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                            <TextBox
                                Grid.Column="1"
                                Grid.Row="1"
                                Margin="0 2 10 2"
                                IsReadOnly="True"
                                FontWeight="Bold"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding LuyKeTamUngChuaThuHoiVonNN, StringFormat={}{0:N0}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                        </Grid>

                        <StackPanel>
                            <TextBlock
                                Margin="0 10 0 0"
                                FontWeight="Bold">Nội dung</TextBlock>
                        </StackPanel>

                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="900"
                                Margin="0 10 0 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Nội dung"
                                Text="{Binding Model.sGhiChu}"
                                TextWrapping="Wrap"
                                Height="60"
                                VerticalScrollBarVisibility="Auto"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock
                                Margin="0 10 0 0"
                                FontWeight="Bold">Số đề nghị tạm ứng, thanh toán KLHT</TextBlock>
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding Model.fGiaTriThanhToanTN, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding Model.fGiaTriThanhToanNN, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>

                        <StackPanel
                            Visibility="{Binding ShowThuHoiTamUng}">
                            <TextBlock
                                Margin="0 10 0 0"
                                FontWeight="Bold">Số thu hồi tạm ứng (theo chế độ)</TextBlock>
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal"
                            Visibility="{Binding ShowThuHoiTamUng}">
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding Model.fGiaTriThuHoiTN, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding Model.fGiaTriThuHoiNN, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>

                        <StackPanel
                            Visibility="{Binding ShowThuHoiTamUngUngTruoc, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock
                                Margin="0 10 0 0"
                                FontWeight="Bold">Số thu hồi tạm ứng (ứng trước)</TextBlock>
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal"
                            Visibility="{Binding ShowThuHoiTamUngUngTruoc, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn trong nước"
                                Text="{Binding Model.FGiaTriThuHoiUngTruocTn, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Vốn ngoài nước"
                                Text="{Binding Model.FGiaTriThuHoiUngTruocNn, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>

                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="450"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Thuế giá trị gia tăng"
                                Text="{Binding Model.FThueGiaTriGiaTang, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <TextBox
                                Width="450"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Chuyển tiền bảo hành"
                                Text="{Binding Model.FChuyenTienBaoHanh, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="450"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                IsReadOnly="True"
                                materialDesign:HintAssist.Hint="Số trả đơn vị thụ hưởng"
                                Text="{Binding Model.FSoTraDonViThuHuong, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                        </StackPanel>

                        <StackPanel>
                            <TextBlock
                                Margin="0 10 0 0"
                                FontWeight="Bold">Thông tin đơn vị thụ hưởng</TextBlock>
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="450"
                                Margin="0 0 10 0"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Tên đơn vị thụ hưởng"
                                Text="{Binding Model.STenDonViThuHuong}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <!--<TextBox
                    Width="250"
                    Margin="0 2 10 2"
                    VerticalAlignment="Center"
                    materialDesign:HintAssist.Hint="Tỷ lệ thanh toán"
                    Text="{Binding FTyLeThanhToan}"
                    IsReadOnly="True"
                    Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>-->
                        </StackPanel>
                        <StackPanel
                            Orientation="Horizontal">
                            <TextBox
                                Width="450"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Số tài khoản"
                                Text="{Binding Model.SSoTaiKhoanNhaThau}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                            <TextBox
                                Width="450"
                                Margin="0 2 10 2"
                                VerticalAlignment="Center"
                                materialDesign:HintAssist.Hint="Mã ngân hàng"
                                Text="{Binding Model.SMaNganHang}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                IsReadOnly="{Binding IsShowDoubleClick,Converter={StaticResource InvertBooleanConverter} }" />
                        </StackPanel>
                        <!--<StackPanel Width="auto" MinHeight="500"></StackPanel>-->
                    </StackPanel>
                </Grid>
            </ScrollViewer>

            <StackPanel
                Grid.Row="2">
                <Separator
                    Background="{DynamicResource MaterialDesignDivider}" />
                <StackPanel
                    Orientation="Horizontal"
                    Margin="0 10 0 0"
                    HorizontalAlignment="Right">
                    <Button
                        Visibility="{Binding IsShowDoubleClick,Converter={StaticResource BooleanToVisibilityConverter}}"
                        IsDefault="True"
                        Margin="5 0 0 0"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"
                        Command="{Binding SaveCommand}">
                        <StackPanel
                            Orientation="Horizontal">
                            <materialDesign:PackIcon
                                Kind="ContentSave" />
                            <TextBlock
                                Style="{StaticResource SearchBarBtnTextStyle}">Lưu dữ liệu</TextBlock>
                        </StackPanel>
                    </Button>
                    <Button
                        Visibility="{Binding IsShowDoubleClick,Converter={StaticResource BooleanToVisibilityConverter}}"
                        IsDefault="True"
                        Margin="5 0 0 0"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"
                        Command="{Binding SaveAndTranferCommand}">
                        <StackPanel
                            Orientation="Horizontal">
                            <materialDesign:PackIcon
                                Kind="ContentSave" />
                            <TextBlock
                                Style="{StaticResource SearchBarBtnTextStyle}">Lưu và chuyển</TextBlock>
                        </StackPanel>
                    </Button>
                    <Button
                        IsCancel="True"
                        Margin="5 0 0 0"
                        Style="{StaticResource MaterialDesignOutlinedButton}">
                        <StackPanel
                            Orientation="Horizontal">
                            <materialDesign:PackIcon
                                Kind="CloseOutline" />
                            <TextBlock
                                Style="{StaticResource SearchBarBtnTextStyle}">Đóng</TextBlock>
                        </StackPanel>
                        <Button.CommandParameter>
                            <system:Boolean>False</system:Boolean>
                        </Button.CommandParameter>
                    </Button>
                </StackPanel>
            </StackPanel>
        </Grid>
    </materialDesign:DialogHost>
</Window>
