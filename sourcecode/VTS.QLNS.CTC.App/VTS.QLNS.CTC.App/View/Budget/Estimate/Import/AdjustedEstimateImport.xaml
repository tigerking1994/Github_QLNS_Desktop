<Window x:Class="VTS.QLNS.CTC.App.View.Budget.Estimate.Import.AdjustedEstimateImport"
        x:Name="AdjustedEstimateImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VTS.QLNS.CTC.App.View.Budget.Estimate.Import"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        xmlns:compt="clr-namespace:VTS.QLNS.CTC.App.Component"
        xmlns:localEnum="clr-namespace:VTS.QLNS.CTC.Utility;assembly=VTS.QLNS.CTC.Utility"
        xmlns:helper="clr-namespace:VTS.QLNS.CTC.App.Helper"
        mc:Ignorable="d"
        WindowState="Maximized"
        Title="Import dữ liệu điều chỉnh dự toán"
        Height="450"
        Width="800">
    <materialDesign:DialogHost Identifier="AdjustedEstimateImport"
                               DialogTheme="Inherit">
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <DockPanel Grid.Row="0">
                <materialDesign:PackIcon Kind="MicrosoftExcel"
                                         Style="{StaticResource DialogScreenIconStyle}" />
                <StackPanel Orientation="Vertical"
                            VerticalAlignment="Center"
                            Margin="10 0">
                    <TextBlock Text="IMPORT DỮ LIỆU ĐIỀU CHỈNH DỰ TOÁN"
                               FontWeight="Bold" />
                </StackPanel>
            </DockPanel>
            <Separator Grid.Row="1"
                       Background="{DynamicResource MaterialDesignDivider}" />
            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Border BorderThickness="1"
                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                        Margin="0 10 0 0"
                        Padding="5 0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 IsEnabled="False"
                                 materialDesign:HintAssist.Hint="Lựa chọn file Excel"
                                 materialDesign:TextFieldAssist.DecorationVisibility="Hidden"
                                 BorderThickness="0"
                                 VerticalAlignment="Center"
                                 Text="{Binding FilePath}" />
                        <Button Style="{DynamicResource MaterialDesignToolButton}"
                                Grid.Column="1"
                                Command="{Binding UploadFileCommand}">
                            <materialDesign:PackIcon Kind="FileUpload"
                                                     Margin="8 0 0 0" />
                        </Button>
                    </Grid>
                </Border>
                <Grid Grid.Row="1"
                      Margin="0 10 0 0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <ComboBox Grid.Column="0"
                              Margin="10 0 10 0"
                              materialDesign:HintAssist.Hint="Chọn đơn vị"
                              materialDesign:TextFieldAssist.HasClearButton="True"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              VirtualizingPanel.IsVirtualizing="True"
                              DisplayMemberPath="DisplayItem"
                              SelectedValuePath="ValueItem"
                              SelectedItem="{Binding AgencySelected}"
                              ItemsSource="{Binding Agencies}" />
                    <DatePicker Grid.Column="1"
                                Language="vi-VN"
                                Margin="10 0 10 0"
                                materialDesign:HintAssist.Hint="Ngày chứng từ"
                                SelectedDate="{Binding VoucherDate}"
                                Text="{Binding VoucherDate}"
                                Style="{StaticResource MaterialDesignFloatingHintDatePicker}" />
                    <ComboBox Grid.Column="2"
                              Margin="10 0 10 0"
                              materialDesign:HintAssist.Hint="Lần điều chỉnh"
                              materialDesign:TextFieldAssist.HasClearButton="True"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                              DisplayMemberPath="DisplayItem"
                              SelectedValuePath="ValueItem"
                              SelectedItem="{Binding EstimateSettlementTypeSelected}"
                              ItemsSource="{Binding EstimateSettlementTypes}" />
                    <ComboBox Grid.Column="3"
                              Margin="10 0 10 0"
                              materialDesign:HintAssist.Hint="Chọn loại chứng từ"
                              materialDesign:TextFieldAssist.HasClearButton="True"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                              DisplayMemberPath="DisplayItem"
                              SelectedValuePath="ValueItem"
                              SelectedItem="{Binding VoucherTypeSelected}"
                              ItemsSource="{Binding VoucherTypes}" />
                    <ComboBox Grid.Column="4"
                              Margin="10 0 10 0"
                              materialDesign:HintAssist.Hint="Tiêu chí"
                              materialDesign:TextFieldAssist.HasClearButton="True"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                              DisplayMemberPath="DisplayItem"
                              SelectedValuePath="ValueItem"
                              SelectedItem="{Binding ImportTieuChiSelected}"
                              ItemsSource="{Binding ImportTieuChiItems}" />
                    <StackPanel Grid.Column="5"
                                Orientation="Horizontal">
                        <Button Margin="10 0 0 0"
                                Width="120"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding ProcessFileCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="FileCheck" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                           Text="Kiểm tra" />
                            </StackPanel>
                        </Button>
                        <Button Margin="5 0 0 0"
                                Width="120"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding ResetDataCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                           Text="Hủy bỏ" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
                <Grid Grid.Row="2"
                      Margin="0 10 0 0">
                    <StackPanel Orientation="Horizontal">
                        <RadioButton x:Name="RbAdjustedEstimateDetail"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     GroupName="TabIndex"
                                     IsChecked="{Binding TabIndex, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static localEnum:ImportTabIndex.Data}}"
                                     Content="Thông tin chứng từ" />
                        <RadioButton x:Name="RbMLNS"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     GroupName="TabIndex"
                                     IsChecked="{Binding TabIndex, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static localEnum:ImportTabIndex.MLNS}}"
                                     Content="Mục lục ngân sách" />
                    </StackPanel>
                </Grid>
                <Grid Grid.Row="3"
                      Margin="0 5 0 0">
                    <DataGrid x:Name="DgAdjustedEstimateImport"
                              Visibility="{Binding IsChecked, ElementName=RbAdjustedEstimateDetail, Converter={StaticResource BooleanToVisibilityConverter}}"
                              AutoGenerateColumns="False"
                              CanUserResizeColumns="True"
                              BorderThickness="1"
                              HorizontalScrollBarVisibility="Auto"
                              FrozenColumnCount="2"
                              EnableRowVirtualization="True"
                              CanUserAddRows="False"
                              GridLinesVisibility="All"
                              RowStyle="{StaticResource DataGridRowDetail}"
                              ItemsSource="{Binding AdjustedEstimateDetails}"
                              SelectedItem="{Binding SelectedItem}">
                        <DataGrid.Resources>
                            <helper:BindingProxy x:Key="DataContextProxy"
                                                 Data="{Binding}" />
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Trạng thái">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ContentControl x:Name="content" />
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding ImportStatus}"
                                                         Value="True">
                                                <Setter TargetName="content"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <materialDesign:PackIcon Kind="CheckCircle"
                                                                                     Foreground="Green"
                                                                                     HorizontalAlignment="Center" />
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ImportStatus}"
                                                         Value="False">
                                                <Setter TargetName="content"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <materialDesign:PackIcon Kind="CloseCircle"
                                                                                     Foreground="Red"
                                                                                     HorizontalAlignment="Center" />
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsWarning}"
                                                         Value="True">
                                                <Setter TargetName="content"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <materialDesign:PackIcon Kind="WarningCircleOutline"
                                                                                     Foreground="Orange"
                                                                                     HorizontalAlignment="Center" />
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="LNS"
                                                Binding="{Binding LNS, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="L"
                                                Binding="{Binding L, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="K"
                                                Binding="{Binding K, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="M"
                                                Binding="{Binding M, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TM"
                                                Binding="{Binding TM, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TTM"
                                                Binding="{Binding TTM, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="NG"
                                                Binding="{Binding NG, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TNG"
                                                Binding="{Binding TNG, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TNG1"
                                                Binding="{Binding TNG1, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TNG2"
                                                Binding="{Binding TNG2, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="TNG3"
                                                Binding="{Binding TNG3, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <DataGridTextColumn Header="Mô tả"
                                                Binding="{Binding Description, UpdateSourceTrigger=LostFocus}"
                                                ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                                                EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}" />
                            <compt:DataGridTextColumn x:Name="DuToanNganSachNam"
                                                      Header="Dự toán ngân sách được giao"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding DuToanNganSachNam, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                                <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}">
                                                    <Grid>
                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Setter Property="Width">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource MultipleWidthConverter}">
                                                                            <Binding ElementName="DuToanNganSachNam"
                                                                                     Path="ActualWidth" />
                                                                            <Binding ElementName="DuToanChuyenNamSau"
                                                                                     Path="ActualWidth" />
                                                                            <Binding ElementName="DuToanConLai"
                                                                                     Path="ActualWidth" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </Grid.Style>
                                                        <TextBlock HorizontalAlignment="Center"
                                                                   Text="Dự toán" />
                                                    </Grid>
                                                </Canvas>
                                            </Border>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Dự toán ngân sách được giao" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="DuToanChuyenNamSau"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding DuToanChuyenNamSau, Converter={StaticResource StringToEmptyConverter},StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Dự kiến chuyển năm sau" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="DuToanConLai"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding DuToanConLai, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border BorderThickness="0 0 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                                <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}"></Canvas>
                                            </Border>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Còn lại" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="DuKienQuyetToanDauNam"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding DuKienQtDauNam, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                                <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}">
                                                    <Grid>
                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Setter Property="Width">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource MultipleWidthConverter}">
                                                                            <Binding ElementName="DuKienQuyetToanDauNam"
                                                                                     Path="ActualWidth" />
                                                                            <Binding ElementName="DuKienQuyetToanCuoiNam"
                                                                                     Path="ActualWidth" />
                                                                            <Binding ElementName="TongCong"
                                                                                     Path="ActualWidth" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </Grid.Style>
                                                        <TextBlock HorizontalAlignment="Center"
                                                                   Text="Dự kiến quyết toán" />
                                                    </Grid>
                                                </Canvas>
                                            </Border>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Đã quyết toán đến thời điểm điều chỉnh" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="DuKienQuyetToanCuoiNam"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding DuKienQtCuoiNam, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Ước thực hiện các tháng cuối năm" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="TongCong"
                                                      StringFormat="{}{0:N0}"
                                                      IsReadOnly="True"
                                                      Binding="{Binding TongCong, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border BorderThickness="0 0 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                                <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}"></Canvas>
                                            </Border>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Ước thực hiện cả năm" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="Tang"
                                                      IsReadOnly="True"
                                                      Header="Tăng"
                                                      StringFormat="{}{0:N0}"
                                                      Binding="{Binding Tang, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                                <DataGridColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <Border Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                                <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}">
                                                    <Grid>
                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Setter Property="Width">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource MultipleWidthConverter}">
                                                                            <Binding ElementName="Tang"
                                                                                     Path="ActualWidth" />
                                                                            <Binding ElementName="Giam"
                                                                                     Path="ActualWidth" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </Grid.Style>
                                                        <TextBlock HorizontalAlignment="Center"
                                                                   Text="Số đề nghị điều chỉnh dự toán ngân sách" />
                                                    </Grid>
                                                </Canvas>
                                            </Border>
                                            <Border Grid.Row="1"
                                                    Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                                    BorderThickness="0 1 1 0"
                                                    BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                                <TextBlock Name="HeaderGroup"
                                                           Text="Tăng" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridColumn.HeaderTemplate>
                            </compt:DataGridTextColumn>
                            <compt:DataGridTextColumn x:Name="Giam"
                                                      Header="Giảm"
                                                      IsReadOnly="True"
                                                      StringFormat="{}{0:N0}"
                                                      Binding="{Binding Giam, Converter={StaticResource StringToEmptyConverter}, StringFormat={}{0:N0}}"
                                                      ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                      EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                      HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}"
                                                      HeaderTemplate="{StaticResource RightHeader}" />
                            <DataGridTemplateColumn Header="Lỗi">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ContentControl x:Name="Function" />
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding ImportStatus}"
                                                         Value="False">
                                                <Setter TargetName="Function"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                                    ToolTip="Xem thông tin lỗi"
                                                                    Width="25"
                                                                    Height="25"
                                                                    Command="{Binding Path=DataContext.ShowErrorCommand, RelativeSource= {RelativeSource FindAncestor, AncestorType={x:Type DataGrid}}}">
                                                                <materialDesign:PackIcon Foreground="DarkRed"
                                                                                         Width="15"
                                                                                         Height="15"
                                                                                         Kind="EyeRemove" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsWarning}"
                                                         Value="True">
                                                <Setter TargetName="Function"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate></DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="MLNS">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ContentControl x:Name="Function" />
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding IsErrorMLNS}"
                                                         Value="True">
                                                <Setter TargetName="Function"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                                    ToolTip="Thêm mục lục ngân sách"
                                                                    Width="25"
                                                                    Height="25"
                                                                    Command="{Binding Path=DataContext.AddMLNSCommand, RelativeSource= {RelativeSource FindAncestor, AncestorType={x:Type DataGrid}}}">
                                                                <materialDesign:PackIcon Foreground="Green"
                                                                                         Width="15"
                                                                                         Height="15"
                                                                                         Kind="FileMoveOutline" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsWarning}"
                                                         Value="True">
                                                <Setter TargetName="Function"
                                                        Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate></DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Grid Visibility="{Binding IsChecked, ElementName=RbMLNS, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="2*"></RowDefinition>
                        </Grid.RowDefinitions>
                        <DataGrid Grid.Row="0"
                                  Style="{StaticResource MaterialDesignDataGrid}"
                                  CellStyle="{StaticResource GenericDataGridCellDetail}"
                                  RowStyle="{StaticResource GenericDataGridRowDetail}"
                                  ItemsSource="{Binding ImportedMlns}"
                                  AutoGenerateColumns="False"
                                  CanUserResizeColumns="True"
                                  BorderThickness="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  FrozenColumnCount="3"
                                  CanUserAddRows="False"
                                  EnableRowVirtualization="True"
                                  GridLinesVisibility="All">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Width="Auto"
                                                        Header=""
                                                        Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                        ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                                        EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="LNS"
                                                    Binding="{Binding Lns}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="L"
                                                    Binding="{Binding L}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="K"
                                                    Binding="{Binding K}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="M"
                                                    Binding="{Binding M}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TM"
                                                    Binding="{Binding TM}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TTM"
                                                    Binding="{Binding TTM}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="NG"
                                                    Binding="{Binding NG}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG"
                                                    Binding="{Binding TNG}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG1"
                                                    Binding="{Binding TNG1}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG2"
                                                    Binding="{Binding TNG2}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG3"
                                                    Binding="{Binding TNG3}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="*"
                                                    Header="Mô tả"
                                                    Binding="{Binding MoTa}"
                                                    IsReadOnly="True" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Margin="0 10"
                                    Grid.Row="1"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Left">
                            <Button IsEnabled="{Binding IsEnabledMergeBtn}"
                                    Width="100"
                                    Style="{StaticResource SearchBarBtnStyle}"
                                    ToolTip="Thêm mới"
                                    Command="{Binding MergeCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Download" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                               Text="Thêm mới"></TextBlock>
                                </StackPanel>
                            </Button>
                            <Button IsEnabled="{Binding IsEnabledUnmergeCommand}"
                                    Width="100"
                                    Style="{StaticResource SearchBarBtnStyle}"
                                    ToolTip="Loại bỏ"
                                    Command="{Binding UnmergeCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Upload" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                               Text="Loại bỏ"></TextBlock>
                                </StackPanel>
                            </Button>
                            <Button IsEnabled="{Binding IsEnableSaveMLNS}"
                                    Width="100"
                                    Style="{StaticResource SearchBarBtnStyle}"
                                    ToolTip="Lưu MLNS"
                                    Command="{Binding SaveMLNSCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSave" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                               Text="Lưu MLNS"></TextBlock>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                        <DataGrid Grid.Row="2"
                                  Style="{StaticResource MaterialDesignDataGrid}"
                                  CellStyle="{StaticResource GenericDataGridCellDetail}"
                                  RowStyle="{StaticResource GenericDataGridRowDetail}"
                                  VerticalAlignment="Top"
                                  ItemsSource="{Binding ExistedMlns}"
                                  AutoGenerateColumns="False"
                                  CanUserResizeColumns="True"
                                  BorderThickness="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  FrozenColumnCount="3"
                                  CanUserAddRows="False"
                                  SelectedItem="{Binding SelectedParent}"
                                  EnableRowVirtualization="True"
                                  GridLinesVisibility="All">
                            <DataGrid.Resources>
                                <Style TargetType="CheckBox"
                                       x:Key="style">
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsModified}"
                                                           Value="false" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="IsEnabled"
                                                    Value="False" />
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Width="Auto"
                                                        Header=""
                                                        Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                        ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                                        EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="LNS"
                                                    Binding="{Binding Lns}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="L"
                                                    Binding="{Binding L}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="K"
                                                    Binding="{Binding K}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="M"
                                                    Binding="{Binding M}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TM"
                                                    Binding="{Binding TM}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TTM"
                                                    Binding="{Binding TTM}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="NG"
                                                    Binding="{Binding NG}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG"
                                                    Binding="{Binding TNG}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG1"
                                                    Binding="{Binding TNG1}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG2"
                                                    Binding="{Binding TNG2}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="Auto"
                                                    Header="TNG3"
                                                    Binding="{Binding TNG3}"
                                                    IsReadOnly="True" />
                                <DataGridTextColumn Width="*"
                                                    Header="Mô tả"
                                                    Binding="{Binding MoTa}"
                                                    IsReadOnly="True" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </Grid>
            <StackPanel Grid.Row="3"
                        Orientation="Horizontal"
                        Margin="0 15 0 0"
                        HorizontalAlignment="Right">
                <Button IsDefault="True"
                        Margin="5 0 0 0"
                        IsEnabled="{Binding IsSaveData}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Command="{Binding SaveCommand}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ContentSave" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Lưu dữ liệu" />
                    </StackPanel>
                </Button>
                <Button IsCancel="True"
                        Margin="5 0 0 0"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Command="{Binding CloseCommand}"
                        CommandParameter="{Binding ElementName=AdjustedEstimateImportWindow}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="CloseOutline" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Đóng" />
                    </StackPanel>
                </Button>
            </StackPanel>
            <compt:ProgressDialog  Margin="0 100 0 0"
                                   Grid.Row="2" />
        </Grid>
    </materialDesign:DialogHost>
</Window>
