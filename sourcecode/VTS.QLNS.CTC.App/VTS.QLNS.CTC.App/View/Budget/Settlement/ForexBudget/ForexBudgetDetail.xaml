<Window x:Class="VTS.QLNS.CTC.App.View.Budget.Settlement.ForexBudget.ForexBudgetDetail"
        x:Name="ForexBudgetDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
        xmlns:localEnum="clr-namespace:VTS.QLNS.CTC.Utility.Enum;assembly=VTS.QLNS.CTC.Utility"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:ext="clr-namespace:VTS.QLNS.CTC.App.Extensions"
        xmlns:component="clr-namespace:VTS.QLNS.CTC.App.Component"
        xmlns:helper="clr-namespace:VTS.QLNS.CTC.App.Helper"
        mc:Ignorable="d"
        Style="{StaticResource MaterialDesignWindow}" 
        Title="Quản lý ngân sách - Cục tài chính"
        Height="768" Width="1280"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Icon="/favicon.ico">
    <Window.InputBindings>
        <KeyBinding Key="F4" Command="{Binding DeleteCommand}" CommandParameter="{Binding ElementName=DgForexBudgetSelfPay1, Path=.}"/>
        <KeyBinding Key="F10" Command="{Binding SaveDataCommand}" />
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}" />
    </Window.InputBindings>
    <materialDesign:DialogHost
        Identifier="ForexBudgetDetailDialog"
        DialogTheme="Inherit">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <StackPanel 
                Grid.Row="0"
                Orientation="Vertical">
                <DockPanel>
                    <materialDesign:PackIcon Kind="Dollar" Style="{StaticResource DialogScreenIconStyle}"/>
                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="CHỨNG TỪ CHI TIẾT"  FontWeight="Bold" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Grid.Column="0">
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="Năm làm việc: {0} | Số: {1} - Ngày: {2} | {3}">
                                            <Binding Path="NamLamViec" />
                                            <Binding Path="Model.SSoChungTu" />
                                            <Binding Path="Model.DNgayChungTu" Converter="{StaticResource DateTimeToStringConverter}" />
                                            <Binding Path="Model.STenDonVi" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </DockPanel>
                <Separator Background="{DynamicResource MaterialDesignDivider}"/>
            </StackPanel>
            <StackPanel
                Grid.Row="1"
                Orientation="Vertical">
                <ScrollViewer HorizontalScrollBarVisibility="Auto">
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Orientation="Horizontal" Visibility="{Binding Model.BKhoa, Converter={StaticResource InvertBooleanToVisibilityConverter}}">
                            <Button 
                                ext:Permission.Identifier="BUDGET_SETTLEMENT_FOREXBUDGET_DETAIL_BTN_DELETE"
                                Style="{StaticResource SearchBarBtnStyle}" 
                                IsEnabled="{Binding IsDelete}"
                                ToolTip="Xóa chi tiết"
                                Command="{Binding DeleteCommand}" CommandParameter="{Binding ElementName=ForexBudgetDetailWindow, Path=.}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Delete" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Xóa (F4)" />
                                </StackPanel>
                            </Button>
                            <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                            <Button 
                                ext:Permission.Identifier="BUDGET_SETTLEMENT_FOREXBUDGET_DETAIL_BTN_DELETE_ALL"
                                Style="{StaticResource SearchBarBtnStyle}" 
                                IsEnabled="{Binding IsDeleteAll}"
                                Command="{Binding DeleteAllCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="DeleteForever" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Xóa tất cả"/>
                                </StackPanel>
                            </Button>
                            <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                            <Button 
                                Style="{StaticResource SearchBarBtnStyle}" 
                                IsEnabled="{Binding IsSaveData}"
                                Command="{Binding SaveDataCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSave" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Lưu dữ liệu (F10)" />
                                </StackPanel>
                            </Button>
                            <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                            <Button 
                                ext:Permission.Identifier="BUDGET_SETTLEMENT_FOREXBUDGET_DETAIL_BTN_EXPLAIN"
                                Style="{StaticResource SearchBarBtnStyle}" 
                                Command="{Binding VerbalExplanationCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="NoteText" />
                                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Giải thích" />
                                </StackPanel>
                            </Button>
                            <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        </StackPanel>
                        <Button 
                            ext:Permission.Identifier="BUDGET_SETTLEMENT_FOREXBUDGET_DETAIL_BTN_LOCK"
                            IsEnabled="{Binding IsSummaried, Converter={StaticResource InvertBooleanConverter}}"
                            Style="{StaticResource SearchBarBtnStyle}"
                            Command="{Binding LockUnLockCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="{Binding Model.BKhoa, Converter={StaticResource InvertBooleanToLockIconConverter}}" />
                                <TextBlock 
                                Style="{StaticResource SearchBarBtnTextStyle}"
                                x:Name="TblLock"
                                Text="{Binding Model.BKhoa, Converter={StaticResource InvertBooleanToLockStatusConverter}}" />
                            </StackPanel>
                        </Button>
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <Button 
                            Style="{StaticResource SearchBarBtnStyle}" 
                            ToolTip="Refresh"
                            Command="{Binding RefreshCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Tải lại (F5)" />
                            </StackPanel>
                        </Button>
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <Button 
                            ext:Permission.Identifier="BUDGET_SETTLEMENT_FOREXBUDGET_DETAIL_BTN_PRINT_REPORT"
                            Style="{StaticResource SearchBarBtnStyle}" 
                            Command="{Binding PrintCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Printer" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="In báo cáo" />
                                <materialDesign:PopupBox
                                    Margin="-10 0 0 0"
                                    Grid.Column="1" 
                                    HorizontalAlignment="Right"
                                    IsPopupOpen="{Binding IsOpenPrintPopup, Mode=TwoWay}">
                                    <materialDesign:PopupBox.ToggleContent>
                                        <materialDesign:PackIcon Kind="MenuDown" />
                                    </materialDesign:PopupBox.ToggleContent>
                                    <StackPanel>
                                        <Button Command="{Binding PrintActionCommand}" CommandParameter="{x:Static localEnum:SettlementPrintType.PRINT_COMMUNICATE_SETTLEMENT_LNS}" Content="In thông tri quyết toán - LNS" />
                                        <Separator Style="{StaticResource MaterialDesignLightSeparator}" Background="Gray" Margin="20 0 20 0"/>
                                        <Button Command="{Binding PrintActionCommand}" CommandParameter="{x:Static localEnum:SettlementPrintType.PRINT_FOREX_SETTLEMENT}" Content="Tổng hợp quý - Quyết toán ngoại hối" />
                                    </StackPanel>
                                </materialDesign:PopupBox>
                            </StackPanel>
                        </Button>
                        <StackPanel Orientation="Horizontal" Visibility="{Binding IsTongHop, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                            <ComboBox
                                materialDesign:HintAssist.Hint="-- Cách hiển thị dữ liệu --"
                                DisplayMemberPath="DisplayItem"
                                SelectedValuePath="ValueItem"
                                ItemsSource="{Binding TypeShowAgency}"
                                SelectedItem="{Binding SelectedTypeShowAgency, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                        </StackPanel>
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <Button x:Name="btnShowColSelfPay" Style="{StaticResource SearchBarBtnStyle}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="PlusMinusVariant" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Ẩn/hiện cột" />
                                <materialDesign:PopupBox
                                    Name="pbDynamicColumnSelfPay"
                                    Margin="-10 0 0 0"
                                    HorizontalAlignment="Right"
                                    StaysOpen="True">
                                    <materialDesign:PopupBox.ToggleContent>
                                        <materialDesign:PackIcon Kind="MenuDown"/>
                                    </materialDesign:PopupBox.ToggleContent>
                                </materialDesign:PopupBox>
                            </StackPanel>
                        </Button>
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <ComboBox
                            Name="cbFrozenColumnSelfPay"
                            materialDesign:HintAssist.Hint="Cố định cột"
                            Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                            DisplayMemberPath="DisplayItem"
                            SelectedValuePath="ValueItem"/>
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <Button 
                            Style="{StaticResource SearchBarBtnStyle}" 
                            Command="{Binding CloseCommand}"
                            CommandParameter="{Binding ElementName=ForexBudgetDetailWindow}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="CloseOutline" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Đóng"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
                <Separator Margin="0 5 0 0" Background="{DynamicResource MaterialDesignDivider}"/>
                <StackPanel
                    Orientation="Horizontal">
                    <Grid Width="{Binding ElementName=SelfPayLNS, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayLNS, Path=Visibility}">
                        <TextBox 
                            Margin="5 0 5 0" 
                            Width="100" 
                            materialDesign:HintAssist.Hint="--LNS--" 
                            Text="{Binding DetailFilter.Lns, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                        <materialDesign:PopupBox
                            Margin="-10 0 0 0"
                            Grid.Column="1" 
                            HorizontalAlignment="Right"
                            IsPopupOpen="{Binding IsOpenLnsPopupSelfPay, Mode=TwoWay}"
                            StaysOpen="True">
                            <materialDesign:PopupBox.ToggleContent>
                                <materialDesign:PackIcon Kind="MenuDown"/>
                            </materialDesign:PopupBox.ToggleContent>
                            <Grid Margin="10" MaxHeight="400">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBox 
                                    Grid.Row="0"
                                    materialDesign:HintAssist.Hint="Tìm kiếm"
                                    Text="{Binding DetailFilter.Lns, UpdateSourceTrigger=PropertyChanged}"/>
                                <DataGrid 
                                    Grid.Row="1"
                                    Margin="0 10 0 0"
                                    VerticalAlignment="Top" 
                                    ItemsSource="{Binding BudgetCatalogItems}"  
                                    AutoGenerateColumns="False" 
                                    CanUserResizeColumns="True"
                                    BorderThickness="1"
                                    HorizontalScrollBarVisibility="Auto"
                                    SelectedItem="{Binding SelectedBudgetCatalog}"
                                    CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="LNS" Binding="{Binding Lns}" IsReadOnly="True"/>
                                        <DataGridTextColumn Header="Mô tả" Binding="{Binding MoTa}" IsReadOnly="True"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </materialDesign:PopupBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayL, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayL, Path=Visibility}">
                        <TextBox 
                            Margin="5 0" 
                            MaxLength="4" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="L" 
                            Text="{Binding DetailFilter.L, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayK, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayK, Path=Visibility}">
                        <TextBox 
                            Margin="5 0" 
                            MaxLength="4" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="K" 
                            Text="{Binding DetailFilter.K, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayM, Path=Visibility}">
                        <TextBox 
                            Margin="5 0" 
                            MaxLength="4" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="M" 
                            Text="{Binding DetailFilter.M, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTM, Path=Visibility}">
                        <TextBox 
                            Margin="5 0" 
                            MaxLength="4" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TM"
                            Text="{Binding DetailFilter.TM, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTTM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTTM, Path=Visibility}">
                        <TextBox
                            Margin="5 0"
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TTM" 
                            Text="{Binding DetailFilter.TTM, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayNG, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayNG, Path=Visibility}">
                        <TextBox
                            Margin="5 0" 
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="NG" 
                            Text="{Binding DetailFilter.NG, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG, Path=Visibility}">
                        <TextBox 
                            Margin="5 0"
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TNG" 
                            Text="{Binding DetailFilter.TNG, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG1, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG1, Path=Visibility}">
                        <TextBox 
                            Margin="5 0"
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TNG1" 
                            Text="{Binding DetailFilter.TNG1, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG2, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG2, Path=Visibility}">
                        <TextBox 
                            Margin="5 0"
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TNG2" 
                            Text="{Binding DetailFilter.TNG2, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG3, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG3, Path=Visibility}">
                        <TextBox 
                            Margin="5 0"
                            MaxLength="2" 
                            Style="{StaticResource MaterialDesignFloatingHintTextBox}" 
                            materialDesign:HintAssist.Hint="TNG3" 
                            Text="{Binding DetailFilter.TNG3, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Command="{Binding SearchCommand}" Key="Return" />
                            </TextBox.InputBindings>
                        </TextBox>
                    </Grid>
                    <Button Style="{StaticResource SearchBarBtnStyle}" Command="{Binding SearchCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Search" />
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}" Text="Tìm kiếm" />
                        </StackPanel>
                    </Button>
                    <Button 
                        Style="{StaticResource SearchBarBtnStyle}" 
                        ToolTip="Filter"
                        Command="{Binding ResetSearchCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FilterRemoveOutline" />
                        </StackPanel>
                    </Button>
                    <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                    <ComboBox
                        materialDesign:HintAssist.Hint="-- Hiển thị --"
                        materialDesign:TextFieldAssist.HasClearButton="True"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                        DisplayMemberPath="DisplayItem"
                        SelectedValuePath="ValueItem"
                        SelectedItem="{Binding SelectedDisplayCondition}"
                        ItemsSource="{Binding DisplayConditions}">
                    </ComboBox>
                    <StackPanel Orientation="Horizontal" Visibility="{Binding IsShowAgencyFilter, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                        <ComboBox
                            materialDesign:HintAssist.Hint="-- Đơn vị --"
                            materialDesign:TextFieldAssist.HasClearButton="True"
                            DisplayMemberPath="DisplayItem"
                            SelectedItem="{Binding SelectedAgency}"
                            ItemsSource="{Binding Agencies}"
                            Style="{StaticResource SearchBarHorizontalComboBoxStyle}" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
            <component:ExpandedDataGrid
                x:Name="DgForexBudgetSelfPay1"
                Grid.Row="2"
                Margin="0 5 0 0"
                VerticalAlignment="Top" 
                ItemsSource="{Binding SettlementVoucherDetails}"  
                AutoGenerateColumns="False" 
                CanUserResizeColumns="True"
                BorderThickness="1"
                HorizontalScrollBarVisibility="Auto"
                CanUserAddRows="False"
                CanUserSortColumns="False"
                CanUserDeleteRows="False"
                FrozenColumnCount="12"
                GridLinesVisibility="All"
                ColumnInfo="{Binding Columns}"
                ElementFrozenColumn="{Binding ElementName=cbFrozenColumnSelfPay, Path=., Mode=TwoWay}"
                ElementDynamicColumn="{Binding ElementName=pbDynamicColumnSelfPay, Path=., Mode=TwoWay}"
                Style="{StaticResource MaterialDesignDataGrid}"
                CellStyle="{StaticResource DataGridCellDetail}"
                RowStyle="{StaticResource DataGridRowDetail}"
                SelectedItem="{Binding SelectedItem}"
                ext:RowEditEndingBehaviour.Command="{Binding EditRowCommand}"
                ext:DataGridBehavior.LastColumnFill="True"
                wpf:DataGridAssist.CornerRadius="0 0 4 4"
                ScrollViewer.ScrollChanged="DgForexBudgetSelfPay_ScrollChanged">
                <DataGrid.Resources>
                    <helper:BindingProxy x:Key="DataContextProxy" Data="{Binding}" />
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn x:Name="SelfPayLNS" Header="LNS" Binding="{Binding SLns}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayL" Header="L" Binding="{Binding SL}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayK" Header="K" Binding="{Binding SK}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayM" Header="M" Visibility="{Binding Data.ColumnDisplay.ColumnM, Source={StaticResource DataContextProxy}}" Binding="{Binding SM}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTM" Header="TM" Visibility="{Binding Data.ColumnDisplay.ColumnTM, Source={StaticResource DataContextProxy}}" Binding="{Binding STm}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTTM" Header="TTM" Visibility="{Binding Data.ColumnDisplay.ColumnTTM, Source={StaticResource DataContextProxy}}" Binding="{Binding STtm}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayNG" Header="NG" Visibility="{Binding Data.ColumnDisplay.ColumnNG, Source={StaticResource DataContextProxy}}" Binding="{Binding SNg}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTNG" Header="TNG" Visibility="{Binding Data.ColumnDisplay.ColumnTNG, Source={StaticResource DataContextProxy}}" Binding="{Binding STng}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTNG1" Header="TNG1" Visibility="{Binding Data.ColumnDisplay.ColumnTNG1, Source={StaticResource DataContextProxy}}" Binding="{Binding STng1}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTNG2" Header="TNG2" Visibility="{Binding Data.ColumnDisplay.ColumnTNG2, Source={StaticResource DataContextProxy}}" Binding="{Binding STng2}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn x:Name="SelfPayTNG3" Header="TNG3" Visibility="{Binding Data.ColumnDisplay.ColumnTNG3, Source={StaticResource DataContextProxy}}" Binding="{Binding STng3}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn Width="250" x:Name="SelfPayDescription" Header="Mô tả" Binding="{Binding SMoTa}" IsReadOnly="True" ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn 
                        Visibility="{Binding Data.IsShowColumnDonVi, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                        x:Name="Agency"
                        Header="Đơn vị"
                        Binding="{Binding STenDonVi}"
                        IsReadOnly="True"
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"/>
                    <DataGridTextColumn 
                        x:Name="SelfPaySpend"
                        Header="Dự toán" 
                        Binding="{Binding FDuToan, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}" 
                        IsReadOnly="True"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                    <DataGridTextColumn 
                        x:Name="SelfPaySettled"
                        Header="Đã quyết toán" 
                        Binding="{Binding FDaQuyetToan, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}" 
                        IsReadOnly="True"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                    <DataGridTextColumn 
                        x:Name="SelfPayExistence"
                        Header="Còn lại" 
                        Binding="{Binding FConLai, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}" 
                        IsReadOnly="True"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"/>
                    <component:DataGridTextColumn 
                        x:Name="Suggestion"
                        Header="Đề nghị"
                        StringFormat="{}{0:N0}"
                        Binding="{Binding FTuChiDeNghi, UpdateSourceTrigger=LostFocus, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                        <DataGridColumn.HeaderTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Border
                                        Padding="{Binding RelativeSource={RelativeSource Self}, Path=(wpf:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                        <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}">
                                            <Grid>
                                                <Grid.Style>
                                                    <Style TargetType="Grid">
                                                        <Setter Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource MultipleWidthConverter}">
                                                                    <Binding ElementName="Suggestion" Path="ActualWidth"/>
                                                                    <Binding ElementName="Approval" Path="ActualWidth"/>
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </Grid.Style>
                                                <TextBlock HorizontalAlignment="Center" Text="Quyết toán - Tự chi"/>
                                            </Grid>
                                        </Canvas>
                                    </Border>
                                    <Border
                                        Grid.Row="1"
                                        Padding="{Binding RelativeSource={RelativeSource Self}, Path=(wpf:DataGridAssist.ColumnHeaderPadding)}"
                                        BorderThickness="0 1 1 0"
                                        BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                        <TextBlock Name="HeaderGroup" Text="{Binding}"/>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </DataGridColumn.HeaderTemplate>
                    </component:DataGridTextColumn>
                    <component:DataGridTextColumn 
                        x:Name="Approval"
                        Header="Phê duyệt"
                        StringFormat="{}{0:N0}"
                        Binding="{Binding FTuChiPheDuyet, UpdateSourceTrigger=LostFocus, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}"
                        HeaderTemplate="{StaticResource RightHeader}"/>
                    <DataGridTextColumn 
                        x:Name="FDeNghiChuyenSangNamSau"
                        Header="Tổng dự toán chuyển năm sau" 
                        Binding="{Binding FDeNghiChuyenNamSau, UpdateSourceTrigger=LostFocus, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                        ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                        HeaderStyle="{StaticResource DataGridColumnHeaderCenter}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}"/>
                    <component:DataGridTextColumn x:Name="DaCapTien"
                                                  Header="Đã cấp tiền"
                                                  StringFormat="{}{0:N0}"
                                                  Binding="{Binding FChuyenNamSauDaCap, Converter={ StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus, StringFormat={}{0:N0}}"
                                                  ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                  EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                  HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}">
                        <DataGridColumn.HeaderTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Border Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding), Converter={StaticResource HeaderPaddingConverter}}">
                                        <Canvas Height="{Binding ElementName=HeaderGroup, Path=ActualHeight}">
                                            <Grid>
                                                <Grid.Style>
                                                    <Style TargetType="Grid">
                                                        <Setter Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource MultipleWidthConverter}">
                                                                    <Binding ElementName="DaCapTien"
                                                                             Path="ActualWidth" />
                                                                    <Binding ElementName="ChuaCapTien"
                                                                             Path="ActualWidth" />
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </Grid.Style>
                                                <TextBlock HorizontalAlignment="Center"
                                                           Text="Trong đó:" />
                                            </Grid>
                                        </Canvas>
                                    </Border>
                                    <Border Grid.Row="1"
                                            Padding="{Binding RelativeSource={RelativeSource Self}, Path=(materialDesign:DataGridAssist.ColumnHeaderPadding)}"
                                            BorderThickness="0 1 1 0"
                                            BorderBrush="{Binding HorizontalGridLinesBrush, RelativeSource={RelativeSource AncestorType=DataGrid}}">
                                        <TextBlock Name="HeaderGroup"
                                                   Text="Đã cấp tiền" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </DataGridColumn.HeaderTemplate>
                    </component:DataGridTextColumn>
                    <component:DataGridTextColumn x:Name="ChuaCapTien"
                                                  Header="Chưa cấp tiền"
                                                  StringFormat="{}{0:N0}"
                                                  IsReadOnly="True"
                                                  Binding="{Binding FChuyenNamSauChuaCap, Converter={ StaticResource NumberToStringEmptyConverter}, UpdateSourceTrigger=LostFocus, StringFormat={}{0:N0}}"
                                                  ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}"
                                                  EditingElementStyle="{StaticResource DataGridTextColumnEditingRightCell}"
                                                  HeaderStyle="{StaticResource DataGridColumnHeaderNoBorder}"
                                                  HeaderTemplate="{StaticResource RightHeader}" />
                    <DataGridTextColumn 
                        x:Name="SelfPayNote"
                        Header="Ghi chú" 
                        Binding="{Binding SGhiChu, UpdateSourceTrigger=LostFocus}" 
                        ElementStyle="{StaticResource DataGridTextColumnDetailStyle}"
                        EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}"/>
                </DataGrid.Columns>
            </component:ExpandedDataGrid>
            <ScrollViewer Grid.Row="3" x:Name="ScrollBottom" HorizontalScrollBarVisibility="Hidden">
                <StackPanel Orientation="Horizontal">
                    <Grid Width="{Binding ElementName=SelfPayLNS, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayLNS, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayL, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayL, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayK, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayK, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayM, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTM, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTTM, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTTM, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayNG, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayNG, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG1, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG1, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG2, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG2, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayTNG3, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayTNG3, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=SelfPayDescription, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayDescription, Path=Visibility}"></Grid>
                    <Grid Width="{Binding ElementName=Agency, Path=ActualWidth}" Visibility="{Binding ElementName=Agency, Path=Visibility}"/>
                    <Grid Width="{Binding ElementName=SelfPaySpend, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPaySpend, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongDuToan, StringFormat={}{0:N0}}" Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPaySettled, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPaySettled, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongDaQuyetToan, StringFormat={}{0:N0}}" Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayExistence, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayExistence, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongConLai, StringFormat={}{0:N0}}" Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=Suggestion,Path=ActualWidth}" Visibility="{Binding ElementName=Suggestion, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongTuChiDeNghi, StringFormat={}{0:N0}}" Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=Approval,Path=ActualWidth}" Visibility="{Binding ElementName=Approval, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongTuChiPheDuyet, StringFormat={}{0:N0}}" Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=FDeNghiChuyenSangNamSau,Path=ActualWidth}"
                          Visibility="{Binding ElementName=FDeNghiChuyenSangNamSau, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongDeNghiChuyenNamSau, StringFormat={}{0:N0}}"
                                 Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=DaCapTien,Path=ActualWidth}"
                          Visibility="{Binding ElementName=DaCapTien, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongChuyenNamSauDaCap, StringFormat={}{0:N0}}"
                                 Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=ChuaCapTien,Path=ActualWidth}"
                          Visibility="{Binding ElementName=ChuaCapTien, Path=Visibility}">
                        <TextBox Text="{Binding SettlementVoucherTotal.FTongChuyenNamSauChuaCap, StringFormat={}{0:N0}}"
                                 Style="{StaticResource TextBoxTotalCell}"></TextBox>
                    </Grid>
                    <Grid Width="{Binding ElementName=SelfPayNote, Path=ActualWidth}" Visibility="{Binding ElementName=SelfPayNote, Path=Visibility}"></Grid>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </materialDesign:DialogHost>
</Window>
