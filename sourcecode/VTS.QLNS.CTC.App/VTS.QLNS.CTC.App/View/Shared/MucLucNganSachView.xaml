<UserControl x:Class="VTS.QLNS.CTC.App.View.Shared.MucLucNganSachView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:VTS.QLNS.CTC.App.View.Shared"
             xmlns:extensions="clr-namespace:VTS.QLNS.CTC.App.Extensions"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:component="clr-namespace:VTS.QLNS.CTC.App.Component"
             xmlns:helper="clr-namespace:VTS.QLNS.CTC.App.Helper"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
             mc:Ignorable="d"
             d:DesignHeight="400"
             d:DesignWidth="800">
    <UserControl.InputBindings>
    </UserControl.InputBindings>

    <!--Thêmmmmm-->

    <UserControl.Resources>
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </UserControl.Resources>



    <!--Hết Thêmmmmm-->
    <Grid x:Name="pageControlCustom">
        <Grid.InputBindings>
            <KeyBinding Key="F5"
                        Command="{Binding RefreshCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F3"
                        Command="{Binding AddCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F4"
                        Command="{Binding DeleteCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F10"
                        Command="{Binding SaveCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F1"
                        Command="{Binding OpenFilterPopupCommand}" />
            <KeyBinding Key="F6"
                        Command="{Binding OpenReferencePopupCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F7"
                        Command="{Binding ViewDetailCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="F8"
                        Command="{Binding EditDetailCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Key="LeftAlt"
                        Command="{Binding SaveReferenceCommand}" />
            <KeyBinding Gesture="Ctrl+F3"
                        Command="{Binding AddChildCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />
            <KeyBinding Gesture="Ctrl+F6"
                        Command="{Binding SelectMlnsParentCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}" />

        </Grid.InputBindings>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0">
            <materialDesign:PackIcon Kind="DriveDocument"
                                     Height="32"
                                     Width="32"
                                     Foreground="{DynamicResource PrimaryHueMidBrush}" />
            <StackPanel Orientation="Vertical">
                <TextBlock FontWeight="Bold"
                           Text="{Binding Title}"></TextBlock>
                <DockPanel>
                    <TextBlock Text="{Binding Description}"></TextBlock>
                    <TextBlock Text="{Binding Total}"
                               HorizontalAlignment="Left"></TextBlock>
                    <TextBlock Text="{Binding Hint}"
                               HorizontalAlignment="Right"></TextBlock>
                    <!--
                    <TextBlock Text="[F3] Thêm dòng, [F4] Xóa dòng, [F10] Lưu" HorizontalAlignment="Right" FontWeight="Medium"></TextBlock>
                    -->
                </DockPanel>
                <Separator Background="{StaticResource MaterialDesignDivider}"
                           Margin="0 5 0 0" />
            </StackPanel>
        </DockPanel>

        <ScrollViewer Grid.Row="1"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled">
            <StackPanel Margin="0 5"
                        Orientation="Horizontal"
                        Visibility="{Binding IsDialog, Converter={StaticResource InvertBooleanToVisibilityConverter}}">
                <StackPanel.Resources>
                    <Style TargetType="{x:Type ComboBox}"
                           BasedOn="{StaticResource MaterialDesignFloatingHintComboBox}">
                        <Setter Property="Width"
                                Value="150" />
                    </Style>
                </StackPanel.Resources>
                <Button 
                        Style="{DynamicResource SearchBarBtnStyle}"
                        Command="{Binding AddCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}"
                        HorizontalAlignment="Right"
                        x:Name="btnAdd">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Plus" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Tạo Mới (F3)" />
                    </StackPanel>
                </Button>
                <Separator
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button
                        Style="{DynamicResource SearchBarBtnStyle}"
                        Command="{Binding AddChildCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}"
                        HorizontalAlignment="Right"
                        x:Name="btnAddChild">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Plus" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Tạo Mới Dòng Con (Ctrl+F3)" />
                    </StackPanel>
                </Button>
                <Separator Visibility="{Binding IsEnableAddChild, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button 
                        Style="{DynamicResource SearchBarBtnStyle}"
                        Command="{Binding DeleteCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}"
                        HorizontalAlignment="Right"
                        x:Name="btnDelete">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Delete" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Xóa (F4)" />
                    </StackPanel>
                </Button>
                <Separator 
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button 
                        Style="{DynamicResource SearchBarBtnStyle}"
                        Command="{Binding SaveCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}"
                        HorizontalAlignment="Right"
                        x:Name="btnSave">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ContentSave" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Lưu dữ liệu (F10)" />
                    </StackPanel>
                </Button>
                <Separator 
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button 
                        Style="{DynamicResource SearchBarBtnStyle}"
                        Command="{Binding RefreshCommand}"
                        CommandParameter="{Binding ElementName=dgdDataMLNS, Path=.}"
                        HorizontalAlignment="Right"
                        x:Name="btnRefesh">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Refresh" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Refesh (F5)" />
                    </StackPanel>
                </Button>
                <Separator
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <ComboBox Name="cbFrozenColumn"
                          materialDesign:HintAssist.Hint="Cố định cột"
                          DisplayMemberPath="DisplayItem"
                          SelectedValuePath="ValueItem" />
                <Separator 
                           Style="{StaticResource SearchBarHorizontalDividerStyle}" />
                <Button x:Name="btnShowCol"
                        Style="{StaticResource SearchBarBtnStyle}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="PlusMinusVariant" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                                   Text="Ẩn/hiện cột" />
                        <materialDesign:PopupBox Name="pbDynamicColumn"
                                                 Margin="-10 0 0 0"
                                                 HorizontalAlignment="Right"
                                                 StaysOpen="True">
                            <materialDesign:PopupBox.ToggleContent>
                                <materialDesign:PackIcon Kind="MenuDown" />
                            </materialDesign:PopupBox.ToggleContent>
                        </materialDesign:PopupBox>
                    </StackPanel>
                </Button>
                <Separator 
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button
                        x:Name="btnExcel"
                        Style="{StaticResource SearchBarBtnStyle}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="FileExcel" />
                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Excel</TextBlock>
                        <materialDesign:PopupBox Margin="-10 0 0 0"
                                                 Grid.Column="1"
                                                 HorizontalAlignment="Right">
                            <materialDesign:PopupBox.ToggleContent>
                                <materialDesign:PackIcon Kind="MenuDown" />
                            </materialDesign:PopupBox.ToggleContent>
                            <StackPanel>
                                <Button Content="Xuất file excel"
                                        Command="{Binding ExportCommand}"
                                         />
                                <Button Content="Import từ file Excel"
                                        Command="{Binding ImportExcelCommand}"
                                         />
                            </StackPanel>
                        </materialDesign:PopupBox>
                    </StackPanel>
                </Button>
               
                <Separator
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <Button Style="{DynamicResource SearchBarBtnStyle}"
                    Command="{Binding SelectMlnsParentCommand}"
                    HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="CodeJson" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                               Text="Chọn Mlns cha (Ctrl + F6)" />
                            </StackPanel>
                </Button>
                <Separator 
                           Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />                
                <Button 
                    Style="{DynamicResource SearchBarBtnStyle}"
                    Command="{Binding ViewDetailCommand}"
                    HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Eye" />
                                <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                               Text="Xem chi tiết (F7)" />
                            </StackPanel>   
                </Button>
                <!--<Button Visibility="{Binding IsVisibleViewDetailBtn, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Style="{DynamicResource SearchBarBtnStyle}"
                    Command="{Binding EditDetailCommand}"
                    HorizontalAlignment="Right">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Gear" />
                                        <TextBlock Style="{StaticResource SearchBarBtnTextStyle}"
                               Text="Thêm mlns cha(F8)" />
                                    </StackPanel>
                                </Button>-->
                <Separator Style="{StaticResource SearchBarHorizontalDividerStyle}"
                           Margin="5 7" />
                <TextBlock VerticalAlignment="Center"
                           Text=" Lọc theo cột (F1)" />
            </StackPanel>
        </ScrollViewer>

        <component:CategoryExpandedDataGrid x:Name="dgdDataMLNS"
                                            Grid.Row="2"
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            BorderThickness="1"
                                            GridLinesVisibility="All"
                                            FrozenColumnCount="3"
                                            ElementFrozenColumn="{Binding ElementName=cbFrozenColumn, Path=., Mode=TwoWay}"
                                            ElementDynamicColumn="{Binding ElementName=pbDynamicColumn, Path=., Mode=TwoWay}"
                                            Style="{StaticResource MaterialDesignDataGrid}"
                                            CellStyle="{StaticResource GenericDataGridCellDetail}"
                                            RowStyle="{StaticResource GenericDataGridRowDetail}"
                                            SelectedItem="{Binding SelectedItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            ItemsSource="{Binding Items, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            extensions:GridAutoGeneratingColumnBehaviour.Command="{Binding AutoGeneratingColumnsCommand}"
                                            BeginningEdit="DataGrid_BeginningEdit"
                                            EnableRowVirtualization="True"
                                            extensions:SelectedCellChangedProperty.Command="{Binding SelectedCellChangeCommand}"
                                            MaxWidth="2560"
                                            MaxHeight="1600"
                                            AutoGenerateColumns="False">
            <DataGrid.Resources>
                <helper:BindingProxy x:Key="DataContextProxy"
                                     Data="{Binding}" />
            </DataGrid.Resources>
            <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="Chọn"
                                        Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                        ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                        EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}"
                                        Visibility="{Binding Data.IsDialog, Source={StaticResource DataContextProxy}, Converter={StaticResource InverseBoolToVisConverter}}">
                </DataGridCheckBoxColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding Lns, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.LNS, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Lns</TextBlock>
                            <materialDesign:PopupBox Name="Lnspopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.Lns, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="Lnstxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="Lns"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="Lns"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding L, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.L, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">L</TextBlock>
                            <materialDesign:PopupBox Name="Lpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.L, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="Ltxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="L"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="L"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding K, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.K, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">K</TextBlock>
                            <materialDesign:PopupBox Name="Kpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.K, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="Ktxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="K"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="K"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding M, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.M, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">M</TextBlock>
                            <materialDesign:PopupBox Name="Mpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.M, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="Mtxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="M"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="M"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TM, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TM, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TM</TextBlock>
                            <materialDesign:PopupBox Name="TMpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TM, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TMtxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TM"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TM"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TTM, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TTM, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TTM</TextBlock>
                            <materialDesign:PopupBox Name="TTMpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TTM, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TTMtxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TTM"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TTM"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding NG, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.NG, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">NG</TextBlock>
                            <materialDesign:PopupBox Name="NGpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.NG, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="NGtxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="NG"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="NG"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TNG, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TNG, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TNG</TextBlock>
                            <materialDesign:PopupBox Name="TNGpopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TNG, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TNGtxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TNG1, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TNG1, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TNG1</TextBlock>
                            <materialDesign:PopupBox Name="TNG1popupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TNG1, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TNG1txtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG1"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG1"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TNG2, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TNG2, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TNG2</TextBlock>
                            <materialDesign:PopupBox Name="TNG2popupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TNG2, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TNG2txtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG2"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG2"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding TNG3, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   Visibility="{Binding Data.TNG3, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">TNG3</TextBlock>
                            <materialDesign:PopupBox Name="TNG3popupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.TNG3, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="TNG3txtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG3"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="TNG3"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding MoTa, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Mô tả</TextBlock>
                            <materialDesign:PopupBox Name="MoTapopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.MoTa, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="MoTatxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="MoTa"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="MoTa"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                                             Background="White"
                                                                             Opacity="0.5"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>
                <materialDesign:DataGridTextColumn Binding="{Binding FTienAn, StringFormat={}{0:N0}, Converter={StaticResource NumberToStringEmptyConverter}}"
                                   ElementStyle="{StaticResource DataGridTextColumnDetailRightStyle}">
                    <materialDesign:DataGridTextColumn.CellStyle>
                        <Style TargetType="DataGridCell"
               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                             Value="True">
                                    <Setter Property="IsEnabled"
                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                             Value="False">
                                    <Setter Property="IsEnabled"
                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </materialDesign:DataGridTextColumn.CellStyle>

                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text=" Mức tiền ăn (đồng/ngày)"/>                            
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>

                <!--Thêmmmmm-->

                <DataGridTextColumn x:Name="TuChi"
                                    Header="Tự chi"
                                    Binding="{Binding TuChi, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="IsEnabled"
                    Value="{Binding BHangCha, Converter={StaticResource InverseBooleanConverter}}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <Setter Property="IsReadOnly"
                    Value="{Binding BHangCha}" />
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>






                <!--Hết Thêmmmmm-->
                <materialDesign:DataGridComboBoxColumn ItemsSource="{Binding Data.LstTrangThai, Source={StaticResource DataContextProxy}}"
                                                       SelectedValueBinding="{Binding ITrangThai}"
                                                       DisplayMemberPath="DisplayItem"
                                                       SelectedValuePath="ValueItem">
                    <materialDesign:DataGridComboBoxColumn.Header>
                        <StackPanel>
                            <TextBlock Text="Trạng thái" />
                        </StackPanel>
                    </materialDesign:DataGridComboBoxColumn.Header>
                    <DataGridComboBoxColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableStatus}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridComboBoxColumn.CellStyle>
                </materialDesign:DataGridComboBoxColumn>
                <materialDesign:DataGridComboBoxColumn IsReadOnly="{Binding IsEnableDuToanNGCombobox, Converter= {StaticResource InvertBooleanConverter}}"
                                                       Visibility="{Binding Data.IsDialog, Source={StaticResource DataContextProxy}, Converter={StaticResource InverseBoolToVisConverter}}"
                                                       ItemsSource="{Binding Data.BHangChaChiTietToi, Source={StaticResource DataContextProxy}}"
                                                       SelectedValueBinding="{Binding SDuToanChiTietToi}"
                                                       DisplayMemberPath="DisplayItem"
                                                       SelectedValuePath="ValueItem">
                    <materialDesign:DataGridComboBoxColumn.Header>
                        <StackPanel>
                            <TextBlock Text="Dự toán chi tiết tới" />
                        </StackPanel>
                    </materialDesign:DataGridComboBoxColumn.Header>
                    <DataGridComboBoxColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEnableDuToanNGCombobox}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEnableDuToanNGCombobox}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridComboBoxColumn.CellStyle>
                </materialDesign:DataGridComboBoxColumn>
                <materialDesign:DataGridComboBoxColumn IsReadOnly="{Binding IsEnableQuyetToanNGCombobox, Converter= {StaticResource InvertBooleanConverter}}"
                                                       Visibility="{Binding Data.IsDialog, Source={StaticResource DataContextProxy}, Converter={StaticResource InverseBoolToVisConverter}}"
                                                       ItemsSource="{Binding Data.BHangChaChiTietToi, Source={StaticResource DataContextProxy}}"
                                                       SelectedValueBinding="{Binding SQuyetToanChiTietToi}"
                                                       DisplayMemberPath="DisplayItem"
                                                       SelectedValuePath="ValueItem">
                    <materialDesign:DataGridComboBoxColumn.Header>
                        <StackPanel>
                            <TextBlock Text="Quyết toán chi tiết tới" />
                        </StackPanel>
                    </materialDesign:DataGridComboBoxColumn.Header>
                    <DataGridComboBoxColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEnableQuyetToanNGCombobox}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEnableQuyetToanNGCombobox}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridComboBoxColumn.CellStyle>
                </materialDesign:DataGridComboBoxColumn>
                <materialDesign:DataGridComboBoxColumn IsReadOnly="{Binding IsEditableCPChiTietToi, Converter= {StaticResource InvertBooleanConverter}}"
                                                       Visibility="{Binding Data.IsDialog, Source={StaticResource DataContextProxy}, Converter={StaticResource InverseBoolToVisConverter}}"
                                                       ItemsSource="{Binding Data.CPChiTietToi, Source={StaticResource DataContextProxy}}"
                                                       SelectedValueBinding="{Binding SCPChiTietToi}"
                                                       DisplayMemberPath="DisplayItem"
                                                       SelectedValuePath="ValueItem">
                    <materialDesign:DataGridComboBoxColumn.Header>
                        <StackPanel>
                            <TextBlock Text="Cấp phát chi tiết tới" />
                        </StackPanel>
                    </materialDesign:DataGridComboBoxColumn.Header>
                    <DataGridComboBoxColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditableCPChiTietToi}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEditableCPChiTietToi}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridComboBoxColumn.CellStyle>
                </materialDesign:DataGridComboBoxColumn>
                <materialDesign:DataGridTextColumn IsReadOnly="True"
                                                   Binding="{Binding MlnsParentName, UpdateSourceTrigger=PropertyChanged}"
                                                   Visibility="{Binding Data.IsDialog, Source={StaticResource DataContextProxy}, Converter={StaticResource InverseBoolToVisConverter}}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">MLNS Cha (F6)</TextBlock>
                            <materialDesign:PopupBox Name="MlnsParentNamepopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.MoTa, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="MlnsParentNametxtbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="MlnsParentName"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="MlnsParentName"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                                             Background="White"
                                                                             Opacity="0.5"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>

                <materialDesign:DataGridComboBoxColumn ItemsSource="{Binding Data.LstCapBac, Source={StaticResource DataContextProxy}}"
                                                       SelectedValueBinding="{Binding SMaCB}"
                                                       DisplayMemberPath="DisplayItem"
                                                       SelectedValuePath="ValueItem">
                    <materialDesign:DataGridComboBoxColumn.Header>
                        <StackPanel>
                            <TextBlock Text="Đối tượng" />
                        </StackPanel>
                    </materialDesign:DataGridComboBoxColumn.Header>
                    <DataGridComboBoxColumn.CellStyle>
                        <Style TargetType="DataGridCell"
                               BasedOn="{StaticResource DataGridCellDetail}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEnableMaCB}"
                                             Value="True">
                                    <Setter Property="IsEnabled"
                                            Value="True" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsEnableMaCB}"
                                             Value="False">
                                    <Setter Property="IsEnabled"
                                            Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridComboBoxColumn.CellStyle>
                </materialDesign:DataGridComboBoxColumn>

                <materialDesign:DataGridTextColumn Binding="{Binding SktKyHieu, UpdateSourceTrigger=PropertyChanged}"
                                                   ElementStyle="{StaticResource DataGridTextColumnStyle}"
                                                   IsReadOnly="True"
                                                   Visibility="{Binding Data.SktKyHieu, Source={StaticResource DataContextProxy}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   EditingElementStyle="{StaticResource DataGridTextColumnEditingStyle}">
                    <materialDesign:DataGridTextColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">SKT Ký Hiệu</TextBlock>
                            <materialDesign:PopupBox Name="SktKyHieupopupbox"
                                                     Padding="0,0,0,0"
                                                     HorizontalAlignment="Right">
                                <materialDesign:PopupBox.ToggleContent>
                                    <materialDesign:PackIcon Kind="FilterOutline"
                                                             Opacity="0.5" />
                                </materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,0">
                                    <materialDesign:ColorZone Mode="PrimaryLight">
                                        <Border Background="White"
                                                Margin="5,5,5,5"
                                                MaxHeight="30"
                                                CornerRadius="3"
                                                BorderThickness="1,1,1,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox Width="150"
                                                         Margin="5,0,0,0"
                                                         BorderThickness="0,0,0,0"
                                                         Text="{Binding Data.FilterModel.SktKyHieu, Source={StaticResource DataContextProxy}, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         Name="SktKyHieutextbox"
                                                         Loaded="Lnstxtbox_Loaded">
                                                    <TextBox.InputBindings>
                                                        <KeyBinding Command="{Binding Data.FilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="SktKyHieu"
                                                                    Key="Return" />
                                                        <KeyBinding Command="{Binding Data.EscapteFilterCommand, Source={StaticResource DataContextProxy}}"
                                                                    CommandParameter="SktKyHieu"
                                                                    Key="Esc" />
                                                    </TextBox.InputBindings>
                                                </TextBox>
                                                <Button Height="30"
                                                        Width="30"
                                                        Style="{StaticResource MaterialDesignToolButton}">
                                                    <materialDesign:PackIcon Kind="Filter"
                                                                             Background="White"></materialDesign:PackIcon>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </materialDesign:ColorZone>
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </StackPanel>
                    </materialDesign:DataGridTextColumn.Header>
                </materialDesign:DataGridTextColumn>

                <DataGridTemplateColumn>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button BorderBrush="Transparent"
                                    BorderThickness="0"
                                    Margin="-16 -8 -16 -8"
                                    Visibility="{Binding IsEnableCheckData, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    x:Name="btnAdd"
                                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type DataGrid}}, Path=DataContext.CheckDataCommand}"
                                    Style="{StaticResource SearchBarBtnStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="WarningCircleOutline" />
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </component:CategoryExpandedDataGrid>
        <StackPanel Orientation="Horizontal"
                    Margin="0 15 15 15"
                    HorizontalAlignment="Right"
                    Visibility="{Binding VisibilityDialogBtn}"
                    Grid.Row="3">
            <Button IsDefault="True"
                    Margin="5 0 0 0"
                    Command="{Binding SaveReferenceCommand}">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="ContentSave" />
                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Chọn (Alt+Enter)</TextBlock>
                </StackPanel>
            </Button>
            <Button Margin="5 0 0 0"
                    IsCancel="True"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Command="{x:Static wpf:DialogHost.CloseDialogCommand}">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="CloseOutline" />
                    <TextBlock Style="{StaticResource SearchBarBtnTextStyle}">Đóng</TextBlock>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>